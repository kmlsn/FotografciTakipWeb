
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
@using FotografciTakipWeb.Models
@{
    int Onaysayac = 1,FirmaSayac=1;
    List<Siparisler> OnayBekleyenOdemler = ViewBag.OnayBekleyenOdemler;
    List<Firma> YeniFirmalar = ViewBag.YeniFirmalar;
}
<div class="row">
    <div class="col-sm-4 col-xl-4">
        <div class="p-3 bg-primary-500 rounded overflow-hidden position-relative text-white mb-g">
            <div class="">
                @if (ViewBag.ToplamGelir == 0)
                {
                <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGelir">
                    0,00 TL
                    <small class="m-0 l-h-n">Toplam Gelir</small>
                </h3>
                }
                else
                {
                <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGelir">
                    @ViewBag.ToplamGelir.ToString("C").Replace("₺", "") TL
                    <small class="m-0 l-h-n">Toplam Gelir</small>
                </h3>
                }
            </div>
            <i class="fal fa-plus-circle position-absolute pos-right pos-bottom opacity-15 mb-n0 mr-n0" style="font-size:6rem"></i>
        </div>
    </div>
    <div class="col-sm-4 col-xl-4">
        <div class="p-3 bg-warning-500 rounded overflow-hidden position-relative text-white mb-g">
            <div class="">
                @if (ViewBag.AktifFirmaSayisi == 0)
                {
                <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGider">
                    0
                    <small class="m-0 l-h-n">Aktif Firma Sayısı</small>
                </h3>
                }
                else
                {
                <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGider">
                    @ViewBag.AktifFirmaSayisi
                    <small class="m-0 l-h-n">Aktif Firma Sayısı</small>
                </h3>
                }
            </div>
            <i class="fal fa-minus-circle position-absolute pos-right pos-bottom opacity-15  mb-n0 mr-n0" style="font-size: 6rem;"></i>
        </div>
    </div>
    <div class="col-sm-4 col-xl-4">
        <!-- alacak - borç  = sonuç (-) ise Kırmızı (bg-danger-200) olacak , (+) ise yeşil (bg-success-200) olacak, (0) ise gri (bg-fusion-50) olacak-->
        <div class="p-3 bg-success-800 rounded overflow-hidden position-relative text-white mb-g" id="BakiyeRenk">
            <div class="">
                @if (ViewBag.AktifKulanici == 0)
                {
                <h3 class="display-4 d-block l-h-n m-0 fw-500" id="Kasa">
                    0
                    <small class="m-0 l-h-n"><strong>Aktif Kullanıcı Sayısı</strong></small>
                </h3>
                }
                else
                {
                <h3 class="display-4 d-block l-h-n m-0 fw-500" id="Kasa">
                    @ViewBag.AktifKulanici
                    <small class="m-0 l-h-n"><strong>Aktif Kullanıcı Sayısı</strong></small>
                </h3>
                }
            </div>
            <!-- alacak - borç  = sonuç (-) ise Simge sağa (<i class="fal fa-balance-scale-right"></i>) olacak , (+) ise simge sola(<i class="fal fa-balance-scale-left"></i>) olacak, (0) ise simge ortada (fal fa-balance-scale) olacak-->
            <i class="fal fa-balance-scale position-absolute pos-right pos-bottom opacity-15 mb-n0 mr-n0" id="BakiyeIkon" style="font-size: 6rem;"></i>
        </div>
    </div>


    <div class="col-lg-6">
        <div id="panel-3" class="panel" data-panel-fullscreen="false">
            <div class="panel-hdr">
                <h2>Yeni Firmalar</h2>
                <button class="btn btn-primary" id="Sms_Tablo_Olustur">SMS Tablosu Oluştur</button>
            </div>
            <div class="panel-container show">
                <div class="panel-content">
                    <div class="frame-wrap">
                        <table class="table table-bordered table-sm m-0">
                            <thead class="thead-themed">
                                <tr>
                                    <th>#</th>
                                    <th>Firma Id</th>
                                    <th>Firma</th>
                                    <th>Yetkili</th>
                                    <th>Telefon</th>
                                    <th>Email</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (YeniFirmalar.Count == 0)
                                {
                                    <tr>
                                        <td colspan="5">
                                            <div class="alert border-danger bg-transparent text-danger m-0" id="YeniFirmaMesaj" role="alert">
                                                Yeni Firma Yok..!
                                            </div>
                                        </td>
                                    </tr>
                                }
                                else
                                {
                                    foreach (var firma in YeniFirmalar)
                                    {
                                        <tr>
                                            <th scope="row">@FirmaSayac</th>
                                            <td>@firma.Id</td>
                                            <td>@firma.FirmaAdi</td>
                                            <td>@firma.Yetkili</td>
                                            <td>@firma.CepTel</td>
                                            <td>@firma.Email</td>
                                        </tr>
                                        FirmaSayac++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div id="panel-3" class="panel" data-panel-fullscreen="false">
            <div class="panel-hdr">
                <h2>Onay Bekleyen Ödemeler</h2>
            </div>
            <div class="panel-container show">
                <div class="panel-content">
                    <div class="frame-wrap">
                        <table class="table table-bordered table-sm m-0">
                            <thead class="thead-themed">
                                <tr>
                                    <th>#</th>
                                    <th>Sipariş No</th>
                                    <th>Firma</th>
                                    <th>Tutar</th>
                                    <th>Onay</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (OnayBekleyenOdemler.Count == 0)
                                {
                                    <tr>
                                        <td colspan="5">
                                            <div class="alert border-danger bg-transparent text-danger m-0" id="OnayBekleyenOdemeMesaj" role="alert">
                                                Onay Bekleyen Ödeme Yok..!
                                            </div>
                                        </td>
                                    </tr>
                                }
                                else
                                {
                                    foreach (var odeme in OnayBekleyenOdemler)
                                    {
                                        <tr>
                                            <th scope="row">@Onaysayac</th>
                                            <td>@odeme.SiparisNo</td>
                                            <td>@odeme.Firma.FirmaAdi</td>
                                            <td>@odeme.PaketTutar.ToString("C").Replace("₺", " ") TL</td>
                                            <td><button type="button" id="OdemeOnay" class="btn btn-xs btn-info waves-effect waves-themed" data-siparisid="@odeme.Id">Onayla</button></td>
                                        </tr>
                                        Onaysayac++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section Script
{
    <script src="~/Areas/Otomasyon/Content/js/tablotarihsirala.js"></script>
    <script>
        $(document).ready(function () {
            $("#OdemeOnay").click(function () {
                var siparisid = $(this).data("siparisid");
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    contentType: false,
                    processData: false,
                    url: "/Admin/Dashboard/OdemeOnay/" + siparisid,
                    success: function (data) {
                        if (data.Sonuc == false) {
                            alertify.set('notifier', 'delay', 8);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.error(data.Mesaj);
                        }
                        else if (data.Sonuc == true) {
                            alertify.set('notifier', 'delay', 8);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.success(data.Mesaj);
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            });
            $("#Sms_Tablo_Olustur").click(function () {
                var siparisid = $(this).data("siparisid");
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    contentType: false,
                    processData: false,
                    url: "/Admin/Dashboard/SmsTabloOlustur/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            alertify.set('notifier', 'delay', 8);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.error(data.Mesaj);
                        }
                        else if (data.Sonuc == true) {
                            alertify.set('notifier', 'delay', 8);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.success(data.Mesaj);
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            });
        });
    </script>
}