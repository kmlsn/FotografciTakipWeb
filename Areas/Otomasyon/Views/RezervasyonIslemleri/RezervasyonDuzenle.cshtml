
@{
    ViewBag.Title = "Sözleşme Düzenle";
    Layout = "~/Areas/Otomasyon/Views/Shared/_Layout.cshtml";
}
@using FotografciTakipWeb.Models
@model Sozlesme
@{
    FotoTakipContext dbContext = new FotoTakipContext();
    List<Personel> personeller = ViewBag.Personeller;
    List<Musteri> musteriler = ViewBag.Musteriler;
    List<CekimPaketleri> paketler = ViewBag.Paketler;
    List<RezervasyonEkHizmet> ekhizmetler = ViewBag.EkHizmetler;
    List<RezervasyonTurleri> rezervasyonturleri = ViewBag.RezervasyonTurleri;
    List<ZamanDilimleri> zamanlar = ViewBag.Zamanlar;
    List<Surecler> surecler = ViewBag.Surecler;
    List<Randevu> CekimRandevulari = ViewBag.CekimRandevulari;
    List<Odemeler> AlinanOdemeler = ViewBag.AlinanOdemeler;
    List<Odemeler> GelecekOdemeler = ViewBag.GelecekOdemeler;
    List<RandevuToPersonel> szPersonelList = ViewBag.szPersonelList;
    //long SubeId = Convert.ToInt64(Session["AktifSubeId"]);
    long OncekiPesonleId = 0;
    long OncekiSurecId = 0;
    string[] paketIDler = { "" };
    string[] ekhizmetIDler = { "" };
    string[] surecIDler = { "" };
    if (Model.PaketlerId != null)
    {
        paketIDler = Model.PaketlerId.Split(',');
    }
    if (Model.EkHizmetlerId != null)
    {
        ekhizmetIDler = Model.EkHizmetlerId.Split(',');
    }
    if (Model.SureclerId != null)
    {
        surecIDler = Model.SureclerId.Split(',');
    }


}
@section Head
{
    <style>
        .swal2-container {
            display: -webkit-box;
            display: flex;
            position: fixed;
            z-index: 300000; /*Uyarı penceresini herşeyin önüne getimek için*/
        }
    </style>
}

<div class="row">
    <div class="col-xl-12">
        <div id="panel-1" class="panel shadow-5">
            <div class="panel-hdr">
                <h3> Rezervasyon Düzenle - @Model.SozlesmeNo</h3>
            </div>
            <div class="panel-container show">
                <div class="panel-content">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-RezervasyonBilgileri" role="tab" id="Tab-RezervasyonBilgileri" aria-selected="false"><i class="fal fa-calendar-alt mr-1"></i> Rezervasyon Bilgileri</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-MusteriBilgileri" role="tab" id="Tab-MusteriBilgileri" aria-selected="false"><i class="fal fa-user mr-1"></i> Müşteri Bilgileri</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-DigerBilgiler" role="tab" id="Tab-DigerBilgiler" aria-selected="false"><i class="fal fa-id-badge mr-1"></i> Diğer Bilgiler</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-PaketVeEkhizmetler" role="tab" id="Tab-PaketVeEkhizmetler" aria-selected="false"><i class="fal fa-star mr-1"></i> Paket ve Ek Hizmetler</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-Surecler" role="tab" id="Tab-Surecler" aria-selected="false"><i class="fal fa-clock mr-1"></i> Süreçler</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-CekimRandevu" role="tab" id="Tab-CekimRandevu" aria-selected="false"><i class="fal fa-camera-alt mr-1"></i>Çekim Randevuları</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#TabPanel-OdemeBilgileri" role="tab" id="Tab-OdemeBilgileri" aria-selected="false"><i class="fal fa-lira-sign mr-1"></i> Ödeme Bilgileri</a>
                        </li>
                        @*<li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#TabPanel-SozlesmeOnizleme" role="tab" id="Tab-SozlesmeOnizleme" aria-selected="false"><i class="fal fa-file-alt mr-1"></i> Sözleşme Önizleme</a>
                            </li>*@
                    </ul>
                    <div class="tab-content border border-top-0 p-3">
                        <div class="tab-pane fade" id="TabPanel-RezervasyonBilgileri" role="tabpanel">
                            <div class="row">
                                <div class="col col-md-6">
                                    <div class="form-group" id="SozlesmeTarihiHata">
                                        <label class="form-label" for="SozlesmeTarihi">Sözleşme Tarihi</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control form-control-sm" style="display:none" value="@Model.SozlesmeTarihi.ToShortDateString()" id="SozlesmeTarihiVT">
                                            <input type="text" style="display:none" id="SozlesmeId" value="@Model.Id">
                                            <input type="text" class="form-control form-control-sm" value="@Model.SozlesmeTarihi.ToShortDateString()" id="SozlesmeTarihi">
                                            <div class="input-group-append">
                                                <span class="input-group-text fs-sm">
                                                    <i class="fal fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group" id="RezervasyonTurIdHata">
                                        <label class="form-label" for="RezervasyonTurId">Rezervasyon Türü</label>
                                        <select class="custom-select form-control custom-select-sm" id="RezervasyonTurId" name="RezervasyonTurId">
                                            <option selected="" value="0">Rezervasyon Türünü Seçiniz</option>
                                            @foreach (var rezervasyonturu in rezervasyonturleri)
                                            {
                                                if (rezervasyonturu.Id == Model.RezervasyonTurId)
                                                {
                                                    <option selected="" value="@rezervasyonturu.Id" data-formalan="@rezervasyonturu.FormAlan">@rezervasyonturu.RezervasyonTuru</option>
                                                }
                                                else
                                                {
                                                    <option value="@rezervasyonturu.Id" data-formalan="@rezervasyonturu.FormAlan">@rezervasyonturu.RezervasyonTuru</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="RezervasyonSekliId">Rezervasyon Şekli</label>
                                        <select class="custom-select form-control custom-select-sm" id="RezervasyonSekliId" name="RezervasyonSekliId">
                                            @if (Model.Durum == "Kesin Rezervasyon")
                                            {
                                                <option selected="" value="1">Kesin Rezervasyon</option>
                                                <option value="2">Opsiyonlu Rezervasyon</option>
                                                <option value="3">Rezervasyon Teklifi</option>
                                            }
                                            else if (Model.Durum == "Opsiyonlu Rezervasyon")
                                            {
                                                <option value="1">Kesin Rezervasyon</option>
                                                <option selected="" value="2">Opsiyonlu Rezervasyon</option>
                                                <option value="3">Rezervasyon Teklifi</option>
                                            }
                                            else if (Model.Durum == "Rezervasyon Teklifi")
                                            {
                                                <option value="1">Kesin Rezervasyon</option>
                                                <option value="2">Opsiyonlu Rezervasyon</option>
                                                <option selected="" value="3">Rezervasyon Teklifi</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-sm-6">
                                            <label class="form-label" for="RezervasyonTarihi">Rezervasyon Tarihi</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control form-control-sm" style="display:none" value="@Model.RezervasyonTarihi.ToShortDateString()" id="RezervasyonTarihiVT" title="İşin yapılacağı tarih">

                                                @if (Model.RezervasyonTarihi != null)
                                                {
                                                    <input type="text" class="form-control form-control-sm" value="@Model.RezervasyonTarihi.ToShortDateString()" id="RezervasyonTarihi" title="İşin yapılacağı tarih">
                                                }
                                                else
                                                {
                                                    <input type="text" class="form-control form-control-sm" value="07/17/2020" id="RezervasyonTarihi" title="İşin yapılacağı tarih">
                                                }
                                                <div class="input-group-append">
                                                    <span class="input-group-text fs-sm">
                                                        <i class="fal fa-calendar-alt"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group col-sm-6">
                                            <label class="form-label" for="ZamanDilimiId">Rezervasyon Saati</label>
                                            <select class="custom-select form-control custom-select-sm" id="ZamanDilimiId" name="ZamanDilimiId" title="İşin saat aralığını seçiniz veya yan taraftan yazınız.">
                                                <option selected="" value="0">Zaman Aralığı Seçiniz</option>
                                                @foreach (var zaman in zamanlar)
                                                {
                                                    if (Model.BaslangicSaat == zaman.BaslangicZaman && Model.BitisSaat == zaman.BitisZaman)
                                                    {
                                                        <option selected="" value="@zaman.Id">@zaman.BaslangicZaman.ToString(@"hh\:mm") - @zaman.BitisZaman.ToString(@"hh\:mm")</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@zaman.Id">@zaman.BaslangicZaman.ToString(@"hh\:mm") - @zaman.BitisZaman.ToString(@"hh\:mm")</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-sm-6" id="ZamanHata">
                                            <label class="form-label" for="BaslangicZaman">Başlangıç Saati</label>
                                            <input class="form-control form-control-sm" id="BaslangicZaman" type="time" name="BaslangicZaman" value="@Model.BaslangicSaat">
                                        </div>
                                        <div class="form-group col-sm-6">
                                            <label class="form-label" for="BitisZaman">Bitiş Saati</label>
                                            <input class="form-control form-control-sm" id="BitisZaman" type="time" name="BitisZaman" value="@Model.BitisSaat">
                                        </div>
                                    </div>
                                </div>

                                <div class="col col-md-6">
                                    <div class="form-group">
                                        <label class="form-label" for="SozlesmeNo">Sözleşme No</label>
                                        <input type="text" id="SozlesmeNo" class="form-control form-control-sm" name="SozlesmeNo" disabled value="@Model.SozlesmeNo">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="OrganizasyonYeri">Organizasyon Yeri</label>
                                        <input type="text" id="OrganizasyonYeri" class="form-control form-control-sm" name="OrganizasyonYeri" maxlength="250" value="@Model.OrganizasyonYeri">
                                    </div>
                                    <div class="form-group" id="OpsiyonTarihiHata">
                                        <label class="form-label" for="OpsiyonTarihi">Opsiyon Tarihi</label>
                                        <div class="input-group">
                                            @if (Model.OpsiyonTarihi == null)
                                            {
                                                <input type="text" class="form-control form-control-sm" style="display:none" value="" id="OpsiyonTarihiVT" disabled title="Opsiyon/Teklif geçerlilik tarihi">
                                            }
                                            else
                                            {
                                                <input type="text" class="form-control form-control-sm" style="display:none" value="@Convert.ToDateTime(Model.OpsiyonTarihi).ToShortDateString()" id="OpsiyonTarihiVT" disabled title="Opsiyon/Teklif geçerlilik tarihi">
                                            }
                                            @if (Model.OpsiyonTarihi != null)
                                            {
                                                <input type="text" class="form-control form-control-sm" value="@Convert.ToDateTime(Model.OpsiyonTarihi).ToShortDateString()" id="OpsiyonTarihi" disabled title="Opsiyon/Teklif geçerlilik tarihi">
                                            }
                                            else
                                            {
                                                <input type="text" class="form-control form-control-sm" value="07/17/2020" id="OpsiyonTarihi" disabled title="Opsiyon/Teklif geçerlilik tarihi">
                                            }
                                            <div class="input-group-append">
                                                <span class="input-group-text fs-sm">
                                                    <i class="fal fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1" id="sozlesmepersonellisthata">
                                            <h5 style="padding-top:5px">
                                                Personeller
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content" id="sozlesmepersonellist">
                                                <div id="sozlesme_personeller_liste">
                                                    <div class="input-group mb-g sticky-top bg-faded">
                                                        <!-- üstte sabitlemek için class a "sticky-top bg-faded" eklendi -->
                                                        <input type="text" class="form-control form-control form-control-sm shadow-inset-2" id="sozlesme_personeller_liste_arama" placeholder="Personel ara">
                                                        <div class="input-group-append">
                                                            <div class="input-group-text">
                                                                <i class="fal fa-search fs-sm"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <ul class="list-group" id="SozlesmePersonelListesi">
                                                        @foreach (var personel in personeller)
                                                        {
                                                            foreach (var szpersonel in szPersonelList)
                                                            {
                                                                if (personel.Id == szpersonel.PersonelId)
                                                                {
                                                                    <li class="list-group-item-changed">
                                                                        <div class="custom-control custom-checkbox">
                                                                            <input type="checkbox" class="custom-control-input" id="@personel.Id" data-persid="@personel.Id" checked="checked">
                                                                            <label class="custom-control-label" data-filter-tags="@personel.AdiSoyadi.ToLower()" for="@personel.Id">@personel.AdiSoyadi - @personel.PersonelGorevleri.Gorev</label>
                                                                        </div>
                                                                    </li>
                                                                    OncekiPesonleId = szpersonel.PersonelId;
                                                                }
                                                            }
                                                            if (personel.Id != OncekiPesonleId)
                                                            {
                                                                <li class="list-group-item-changed">
                                                                    <div class="custom-control custom-checkbox">
                                                                        <input type="checkbox" class="custom-control-input" id="@personel.Id" data-persid="@personel.Id">
                                                                        <label class="custom-control-label" data-filter-tags="@personel.AdiSoyadi.ToLower()" for="@personel.Id">@personel.AdiSoyadi - @personel.PersonelGorevleri.Gorev</label>
                                                                    </div>
                                                                </li>
                                                            }
                                                        }

                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="RezervasyonBilgileriDevam">
                                        Değişiklikleri Kaydet
                                        <i class="fal fa-save ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="TabPanel-MusteriBilgileri" role="tabpanel">
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <input type="text" style="display:none" id="MusteriIdVT" value="@Model.MusteriId">
                                    <label class="form-label" for="MusteriId">Müşteri</label>
                                    <select class="custom-select form-control custom-select-sm" id="MusteriId" name="MusteriId" title="Kayıtlı müşterilerden seçebilirsiniz.">
                                        <option selected="" data-musterikodu="0" value="0">Müşteri Seçiniz - Yeni Müşteri</option>
                                        @foreach (var musteri in musteriler)
                                        {
                                            if (musteri.Id == Model.MusteriId)
                                            {
                                                <option selected="" value="@musteri.Id" data-musterikodu="@musteri.MusteriKodu" data-adsoyad="@musteri.AdiSoyadi"
                                                        data-tckimlikno="@musteri.TCKimlikNo" data-email="@musteri.Email" data-ceptel="@musteri.CepTel"
                                                        data-sabittel="@musteri.SabitTel" data-adres="@musteri.Adres" data-notlar="@musteri.Notlar">
                                                    @musteri.AdiSoyadi
                                                </option>
                                            }
                                            else
                                            {
                                                <option value="@musteri.Id" data-musterikodu="@musteri.MusteriKodu" data-adsoyad="@musteri.AdiSoyadi"
                                                        data-tckimlikno="@musteri.TCKimlikNo" data-email="@musteri.Email" data-ceptel="@musteri.CepTel"
                                                        data-sabittel="@musteri.SabitTel" data-adres="@musteri.Adres" data-notlar="@musteri.Notlar">
                                                    @musteri.AdiSoyadi
                                                </option>
                                            }
                                        }
                                    </select>
                                </div>
                                <div class="form-group col-sm-6">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <label class="form-label" for="MusteriKodu">Müşteri Kodu</label>
                                    <input type="text" id="MusteriKodu" class="form-control form-control-sm" name="MusteriKodu" disabled placeholder="Otomatik Oluşturulacak." value="@Model.Musteri.MusteriKodu">
                                </div>
                                <div class="form-group col-sm-6" id="AdSoyadHata">
                                    <label class="form-label" for="AdSoyad">Ad Soyad</label>
                                    <input type="text" id="AdSoyad" class="form-control form-control-sm disabled" name="AdSoyad" maxlength="50" required disabled value="@Model.Musteri.AdiSoyadi">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <label class="form-label" for="TCKimlikNo">TC Kimlik No</label>
                                    <input type="text" id="TCKimlikNo" class="form-control form-control-sm disabled" name="TCKimlikNo" maxlength="11" data-inputmask="'mask': '99999999999'" disabled value="@Model.Musteri.TCKimlikNo">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label class="form-label">Email Adresi</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                        </div>
                                        <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="Email" id="Email" maxlength="50" value="@Model.Musteri.Email">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6" id="CepTelHata">
                                    <label class="form-label">Cep Telefonu</label>
                                    <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="CepTel" id="CepTel" required value="@Model.Musteri.CepTel">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label class="form-label">Sabit Telefon</label>
                                    <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="SabitTel" id="SabitTel" value="@Model.Musteri.SabitTel">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <label class="form-label" for="Adres">Adres</label>
                                    <textarea class="form-control form-control-sm" id="Adres" rows="2" name="Adres" style="overflow:auto;resize:none">@Model.Musteri.Adres</textarea>
                                </div>
                                <div class="form-group col-sm-6">
                                    <label class="form-label" for="Notlar">Notlar</label>
                                    <textarea class="form-control form-control-sm" id="Notlar" rows="2" name="Notlar" style="overflow:auto;resize:none">@Model.Musteri.Notlar</textarea>
                                </div>
                            </div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                @*<div class="form-check-inline">
                                        <button type="button" class="btn btn-primary waves-effect waves-themed" id="MusteriBilgileriGeri">
                                            <i class="fal fa-arrow-alt-left ml-1"></i>
                                            Geri
                                        </button>
                                    </div>*@
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="MusteriBilgileriDevam">
                                        Değişiklikleri Kaydet
                                        <i class="fal fa-save ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="TabPanel-DigerBilgiler" role="tabpanel">
                            <div class="card m-auto border Gelin">
                                <div class="card-header py-2">
                                    <div class="card-title">
                                        Gelin
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="GelinAdSoyad">Ad Soyad</label>
                                            <input type="text" id="GelinAdSoyad" class="form-control form-control-sm" name="GelinAdSoyad" maxlength="50" value="@Model.GelinAd">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="GelinCep">Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="GelinCep" id="GelinCep" value="@Model.GelinTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label">Email Adresi</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                                </div>
                                                <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="GelinEmail" id="GelinEmail" maxlength="50" value="@Model.GelinEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3 Gelin"></div>
                            <div class="card m-auto border Damat">
                                <div class="card-header py-2">
                                    <div class="card-title">
                                        Damat
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row" style="margin-bottom:-15px">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="DamatAdSoyad">Ad Soyad</label>
                                            <input type="text" id="DamatAdSoyad" class="form-control form-control-sm" name="DamatAdSoyad" maxlength="50" value="@Model.DamatAd">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="DamatCep">Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="DamatCep" id="DamatCep" value="@Model.DamatTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label">Email Adresi</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                                </div>
                                                <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="DamatEmail" id="DamatEmail" maxlength="50" value="@Model.DamatEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3 Damat"></div>
                            <div class="card m-auto border BebekCocuk">
                                <div class="card-header py-2">
                                    <div class="card-title">
                                        Bebek/Çocuk
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="BebekAdSoyad">Bebek/Çocuk Ad Soyad</label>
                                            <input type="text" id="BebekAdSoyad" class="form-control form-control-sm" name="BebekAdSoyad" maxlength="50" value="@Model.CocukAdSoyad">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="BabaAdSoyad">Baba Ad Soyad</label>
                                            <input type="text" id="BabaAdSoyad" class="form-control form-control-sm" name="BabaAdSoyad" maxlength="50" value="@Model.BabaAd">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="AnneAdSoyad">Anne Ad Soyad</label>
                                            <input type="text" id="AnneAdSoyad" class="form-control form-control-sm" name="AnneAdSoyad" maxlength="50" value="@Model.AnneAd">
                                        </div>
                                    </div>
                                    <div class="row" style="margin-bottom:-15px">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="BabaCep">Baba Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="BabaCep" id="BabaCep" value="@Model.BabaTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="AnneCep">Anne Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="AnneCep" id="AnneCep" value="@Model.AnneTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label">Email Adresi</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                                </div>
                                                <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="BabaEmail" id="BabaEmail" maxlength="50" value="@Model.BabaEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3 BebekCocuk"></div>
                            <div class="card m-auto border UrunKatalog">
                                <div class="card-header py-2">
                                    <div class="card-title">
                                        Ürün/Katalog
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="Urunler">Ürünler</label>
                                            <textarea class="form-control form-control-sm" id="Urunler" rows="4" name="Urunler" style="overflow:auto;resize:none">@Model.Urunler</textarea>
                                        </div>
                                    </div>
                                    <div class="row mb-0">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="UrunYetkiliAdSoyad">Yetkili/Sorumlu Ad Soyad</label>
                                            <input type="text" id="UrunYetkiliAdSoyad" class="form-control form-control-sm" name="UrunYetkiliAdSoyad" maxlength="50" value="@Model.YetkiliAdSoyad">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="UrunYetkiliCep">Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="UrunYetkiliCep" id="UrunYetkiliCep" value="@Model.YetkiliTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label">Email Adresi</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                                </div>
                                                <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="UrunYetkiliEmail" id="UrunYetkiliEmail" maxlength="50" value="@Model.YetkiliEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3 UrunKatalog"></div>
                            <div class="card m-auto border ModelManken">
                                <div class="card-header py-2">
                                    <div class="card-title">
                                        Model/Manken
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="Modeller">Model/Manken İsimleri</label>
                                            <textarea class="form-control form-control-sm" id="Modeller" rows="4" name="Modeller" style="overflow:auto;resize:none">@Model.Modeller</textarea>
                                        </div>
                                    </div>
                                    <div class="row mb-0">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="ModelYetkiliAdSoyad">Yetkili/Sorumlu Ad Soyad</label>
                                            <input type="text" id="ModelYetkiliAdSoyad" class="form-control form-control-sm" name="ModelYetkiliAdSoyad" maxlength="50" value="@Model.YetkiliAdSoyad">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="ModelYetkiliCep">Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="ModelYetkiliCep" id="ModelYetkiliCep" value="@Model.YetkiliTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label">Email Adresi</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                                </div>
                                                <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="ModelYetkiliEmail" id="ModelYetkiliEmail" maxlength="50" value="@Model.YetkiliEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3 ModelManken"></div>
                            <div class="card m-auto border Yetkili">
                                <div class="card-header py-2">
                                    <div class="card-title">
                                        Yetkili
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row" style="margin-bottom:-15px">
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="YetkiliAdSoyad">Yetkili/Sorumlu Ad Soyad</label>
                                            <input type="text" id="YetkiliAdSoyad" class="form-control form-control-sm" name="YetkiliAdSoyad" maxlength="50" value="@Model.YetkiliAdSoyad">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label" for="YetkiliCep">Cep Telefonu</label>
                                            <input type="text" data-inputmask="'mask': '(0999) 999-9999'" class="form-control form-control-sm" im-insert="true" name="YetkiliCep" id="YetkiliCep" value="@Model.YetkiliTel">
                                        </div>
                                        <div class="form-group col-sm-4">
                                            <label class="form-label">Email Adresi</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fal fa-mouse-pointer width-1 text-align-center"></i></span>
                                                </div>
                                                <input type="text" data-inputmask="'alias': 'email'" class="form-control form-control-sm" im-insert="true" name="YetkiliEmail" id="YetkiliEmail" maxlength="50" value="@Model.YetkiliEmail">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3 Yetkili"></div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                @*<div class="form-check-inline">
                                        <button type="button" class="btn btn-primary waves-effect waves-themed" id="DigerBilgilerGeri">
                                            <i class="fal fa-arrow-alt-left ml-1"></i>
                                            Geri
                                        </button>
                                    </div>*@
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="DigerBilgilerDevam">
                                        Değişiklikleri Kaydet
                                        <i class="fal fa-save ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="TabPanel-PaketVeEkhizmetler" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Paketler
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content" id="slimtest1">
                                                <div id="paketler_liste">
                                                    <div class="input-group mb-g sticky-top bg-faded">
                                                        <input id="ModelPaketlerId" style="display:none" type="checkbox" value="@Model.PaketlerId"> <!-- Kayıttaki paket Id ler çekilerek üzerine ekleme yada çıkarılma yapılmak için JS işlemleri yapılıyor. -->
                                                        <input id="ModelEkHizmetlerId" style="display:none" type="checkbox" value="@Model.EkHizmetlerId">
                                                        <input id="ModelSureclerId" style="display:none" type="checkbox" value="@Model.SureclerId">
                                                        <!-- üstte sabitlemek için class a "sticky-top bg-faded" eklendi -->
                                                        <input type="text" class="form-control form-control form-control-sm shadow-inset-2" id="paketler_liste_arama" placeholder="Paket ara">
                                                        <div class="input-group-append">
                                                            <div class="input-group-text">
                                                                <i class="fal fa-search fs-sm"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <ul class="list-group" id="Paketler">
                                                        <!--  Paketler burada listelenecek  -->
                                                        @foreach (var paket in paketler)
                                                        {
                                                            <li class="list-group-item-changed">
                                                                <div class="custom-control custom-checkbox">
                                                                    <input type="checkbox" class="custom-control-input form-control-sm paketler paketler-@paket.Id" data-filter-tags="@paket.PaketAdi.ToLower()" id="@paket.Id@paket.PaketAdi.Replace(" ","")" data-paketid="@paket.Id" data-fiyat="@Convert.ToDecimal(paket.Fiyat).ToString("C").Replace("₺", "TL")" data-paketdetay="@paket.PaketDetayi" value="@paket.PaketAdi">
                                                                    <label class="custom-control-label" data-filter-tags="@paket.PaketAdi.ToLower()" for="@paket.Id@paket.PaketAdi.Replace(" ","")">@paket.PaketAdi - <b>@String.Format("{0:C}", paket.Fiyat).Replace("₺", "") TL</b></label>
                                                                </div>
                                                            </li>
                                                        }
                                                        @foreach (var paketId in paketIDler)
                                                        {
                                                            <li class="list-group-item-changed" style="display:none">
                                                                <input class="secilenpaketidleri" style="display:none" type="checkbox" value="@paketId">
                                                            </li>
                                                        }
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div id="panel-2" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Paket Detayları
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content" id="slimtest2">
                                                @foreach (var paketId in paketIDler)
                                                {
                                                    if (paketIDler[0] != "")
                                                    {
                                                        CekimPaketleri pk = paketler.FirstOrDefault(x => x.Id == Convert.ToInt32(paketId));
                                                        <div class='alert alert-primary mb-2'>
                                                            <h5 class='card-title'>
                                                                @pk.PaketAdi
                                                                <span class='fw-700'>
                                                                    - @Convert.ToDecimal(pk.Fiyat).ToString("C").Replace("₺", "") TL
                                                                </span>
                                                            </h5>
                                                            @Html.Raw(pk.PaketDetayi)
                                                        </div>
                                                    }
                                                }
                                                <!-- Seçilen paketlerin içeriği ve fiyatı buraya eklenecek  -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Ek Hizmetler
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content" id="slimtest3">
                                                <div id="hizmetler_liste">
                                                    <div class="input-group mb-g sticky-top bg-faded">
                                                        <!-- üstte sabitlemek için class a "sticky-top bg-faded" eklendi -->
                                                        <input type="text" class="form-control form-control form-control-sm shadow-inset-2" id="hizmetler_liste_arama" placeholder="Ek hizmet ara">
                                                        <div class="input-group-append">
                                                            <div class="input-group-text">
                                                                <i class="fal fa-search fs-sm"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <ul class="list-group" id="EkHizmetler">
                                                        <!--  Paketler burada listelenecek  -->
                                                        @foreach (var ekhizmet in ekhizmetler)
                                                        {
                                                            <li class="list-group-item-changed">
                                                                <div class="custom-control custom-checkbox">
                                                                    <input type="checkbox" class="custom-control-input ekhizmetler ekhizmetler-@ekhizmet.Id" id="@ekhizmet.Id@ekhizmet.EkHizmetAdi.Replace(" ","")" data-filter-tags="@ekhizmet.EkHizmetAdi.ToLower()" data-ekhizmetid="@ekhizmet.Id" data-fiyat="@Convert.ToDecimal(ekhizmet.Fiyat).ToString("C").Replace("₺", "TL")" data-ekhizmetdetay="@ekhizmet.Aciklama" value="@ekhizmet.EkHizmetAdi">
                                                                    <label class="custom-control-label" data-filter-tags="@ekhizmet.EkHizmetAdi.ToLower()" for="@ekhizmet.Id@ekhizmet.EkHizmetAdi.Replace(" ","")">@ekhizmet.EkHizmetAdi - <b>@String.Format("{0:C}", ekhizmet.Fiyat).Replace("₺", "") TL</b></label>
                                                                </div>
                                                            </li>
                                                        }
                                                        @foreach (var ekhizmetId in ekhizmetIDler)
                                                        {
                                                            <li class="list-group-item-changed" style="display:none">
                                                                <input class="secilenekhizmetidleri" style="display:none" type="checkbox" value="@ekhizmetId">
                                                            </li>
                                                        }
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div id="panel-2" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Ek Hizmet Detayları
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content" id="slimtest4">
                                                @foreach (var ekhizmetId in ekhizmetIDler)
                                                {
                                                    if (ekhizmetIDler[0] != "")
                                                    {
                                                        RezervasyonEkHizmet ek = ekhizmetler.FirstOrDefault(x => x.Id == Convert.ToInt32(ekhizmetId));
                                                        <div class='alert alert-secondary mb-2'>
                                                            <h5 class='card-title'>
                                                                @ek.EkHizmetAdi
                                                                <span class='fw-700'>
                                                                    - @Convert.ToDecimal(ek.Fiyat).ToString("C").Replace("₺", "") TL
                                                                </span>
                                                            </h5>
                                                            @Html.Raw(ek.Aciklama)
                                                        </div>
                                                    }
                                                }
                                                <!-- Seçilen paketlerin içeriği ve fiyatı buraya eklenecek  -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div id="panel-2" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Ücretlendirme
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content">
                                                <div class="row">
                                                    <div class="form-group col-sm-3">
                                                        <label class="form-label " for="PaketTutar">Paketler Tutarı </label>
                                                        <input type="text" id="PaketTutarVT" style="display:none" value="@Model.PaketlerFiyat">
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm tutarlar" name="PaketTutar" maxlength="50" id="PaketTutar" disabled value="@Model.PaketlerFiyat">
                                                    </div>
                                                    <div class="form-group col-sm-3">
                                                        <label class="form-label" for="EkHizmetTutar">Ek Hizmetler Tutarı </label>
                                                        <input type="text" id="EkHizmetTutarVT" style="display:none" value="@Model.EkHizmetlerFiyat">
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm tutarlar" name="EkHizmetTutar" maxlength="50" id="EkHizmetTutar" disabled value="@Model.EkHizmetlerFiyat">
                                                    </div>
                                                    <div class="form-group col-sm-3">
                                                        <label class="form-label" for="Iskonto">İskonto </label>
                                                        <input type="text" id="IskontoVT" style="display:none" value="@Model.Iskonto">
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm tutarlar" name="Iskonto" maxlength="50" id="Iskonto" value="@Model.Iskonto">
                                                    </div>
                                                    <div class="form-group col-sm-3">
                                                        <label class="form-label" for="ToplamTutar">Toplam Tutar </label>
                                                        <input type="text" id="ToplamTutarVT" style="display:none" value="@Model.ToplamFiyat">
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm" name="ToplamTutar" maxlength="50" id="ToplamTutar" value="@Model.ToplamFiyat">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                @*<div class="form-check-inline">
                                        <button type="button" class="btn btn-primary waves-effect waves-themed" id="PaketlerGeri">
                                            <i class="fal fa-arrow-alt-left ml-1"></i>
                                            Geri
                                        </button>
                                    </div>*@
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="PaketlerDevam">
                                        Değişiklikleri Kaydet
                                        <i class="fal fa-save ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="TabPanel-Surecler" role="tabpanel">
                            <div class="row">
                                <div class="col-md-12">
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Süreçler
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content" id="slimtest5">
                                                <div id="surecler_liste">
                                                    <div class="input-group mb-g sticky-top bg-faded">
                                                        <!-- üstte sabitlemek için class a "sticky-top bg-faded" eklendi -->
                                                        <input type="text" class="form-control form-control form-control-sm shadow-inset-2" id="surecler_liste_arama" placeholder="Süreç ara">
                                                        <div class="input-group-append">
                                                            <div class="input-group-text">
                                                                <i class="fal fa-search fs-sm"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <ul class="list-group" id="Surecler">
                                                        <!--  Süreçler burada listelenecek  -->

                                                        @foreach (var surec in surecler)
                                                        {
                                                            <li class="list-group-item-changed">
                                                                <div class="custom-control custom-checkbox">
                                                                    @foreach (var surecId in surecIDler)
                                                                    {
                                                                        if (surec.Id == Convert.ToInt64(surecId))
                                                                        {
                                                                            if (surec.SurecAdi == "Sözleşme Yapıldı")
                                                                            {
                                                                                <input type="checkbox" checked disabled class="custom-control-input" id="@surec.Id@surec.SurecAdi.Replace(" ","")" data-surecid="@surec.Id">
                                                                                <label class="custom-control-label" data-filter-tags="@surec.SurecAdi.ToLower()" for="@surec.SurecAdi.Replace(" ","")">@surec.SurecAdi</label>
                                                                            }
                                                                            else
                                                                            {
                                                                                <input type="checkbox" checked class="custom-control-input surecler surecler-@surec.Id" id="@surec.SurecAdi.Replace(" ","")" data-surecid="@surec.Id">
                                                                                <label class="custom-control-label" data-filter-tags="@surec.SurecAdi.ToLower()" for="@surec.SurecAdi.Replace(" ","")">@surec.SurecAdi</label>
                                                                            }
                                                                            OncekiSurecId = Convert.ToInt64(surecId);
                                                                        }
                                                                    }
                                                                    @if (surec.Id != OncekiSurecId)
                                                                    {
                                                                        <input type="checkbox" class="custom-control-input surecler surecler-@surec.Id" id="@surec.SurecAdi.Replace(" ","")" data-surecid="@surec.Id">
                                                                        <label class="custom-control-label" data-filter-tags="@surec.SurecAdi.ToLower()" for="@surec.SurecAdi.Replace(" ","")">@surec.SurecAdi</label>

                                                                    }
                                                                </div>
                                                            </li>
                                                        }
                                                        @*@foreach (var surec in surecler)
                                                            {
                                                                <li class="list-group-item-changed">
                                                                    <div class="custom-control custom-checkbox">
                                                                        @if (surec.SurecAdi == "Sözleşme Yapıldı")
                                                                        {
                                                                            <input type="checkbox" checked disabled class="custom-control-input" id="@surec.Id@surec.SurecAdi.Replace(" ","")" data-surecid="@surec.Id">
                                                                            <label class="custom-control-label" data-filter-tags="@surec.SurecAdi.ToLower()" for="@surec.SurecAdi.Replace(" ","")">@surec.SurecAdi</label>
                                                                        }
                                                                        else
                                                                        {

                                                                            foreach (var surecId in surecIDler)
                                                                            {
                                                                                if (surec.Id == Convert.ToInt64(surecId))
                                                                                {
                                                                                    <input type="checkbox" checked class="custom-control-input surecler surecler-@surec.Id" id="@surec.SurecAdi.Replace(" ","")" data-surecid="@surec.Id">
                                                                                    <label class="custom-control-label" data-filter-tags="@surec.SurecAdi.ToLower()" for="@surec.SurecAdi.Replace(" ","")">@surec.SurecAdi</label>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <input type="checkbox" class="custom-control-input surecler surecler-@surec.Id" id="@surec.SurecAdi.Replace(" ","")" data-surecid="@surec.Id">
                                                                                    <label class="custom-control-label" data-filter-tags="@surec.SurecAdi.ToLower()" for="@surec.SurecAdi.Replace(" ","")">@surec.SurecAdi</label>
                                                                                }
                                                                            }
                                                                        }
                                                                    </div>
                                                                </li>
                                                            }
                                                            @foreach (var surecId in surecIDler)
                                                            {
                                                                <li class="list-group-item-changed" style="display:none">
                                                                    <input class="secilensurecidleri" style="display:none" type="checkbox" value="@surecId">
                                                                </li>
                                                            }*@
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                @*<div class="form-check-inline">
                                        <button type="button" class="btn btn-primary waves-effect waves-themed" id="SureclerGeri">
                                            <i class="fal fa-arrow-alt-left ml-1"></i>
                                            Geri
                                        </button>
                                    </div>*@
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="SureclerDevam">
                                        Değişiklikleri Kaydet
                                        <i class="fal fa-save ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="TabPanel-CekimRandevu" role="tabpanel">
                            <div class="row">
                                <div class="col-md-12">
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Çekim Randevuları
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content">
                                                <div class="alert alert-secondary" role="alert">
                                                    <strong>Uyarı!</strong> <br />Rezervasyon tarihi haricinde ek olarak yapılacak çekimleri ekleyiniz.
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="row">
                                                            <div class="form-group col-sm-12">
                                                                <label class="form-label" for="CekimTarihi">Tarih</label>
                                                                <div class="input-group">
                                                                    <input type="text" class="form-control form-control-sm" value="07/17/2020" id="CekimTarihi">
                                                                    <div class="input-group-append">
                                                                        <span class="input-group-text fs-sm">
                                                                            <i class="fal fa-calendar-alt"></i>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-sm-6" id="CekimZamanHata">
                                                                <label class="form-label" for="CekimBaslangic">Başlangıç Saati</label>
                                                                <input class="form-control form-control-sm" id="CekimBaslangic" type="time" name="CekimBaslangic" value="00:00">
                                                            </div>
                                                            <div class="form-group col-sm-6">
                                                                <label class="form-label" for="CekimBitis">Bitiş Saati</label>
                                                                <input class="form-control form-control-sm" id="CekimBitis" type="time" name="CekimBitis" value="00:00">
                                                            </div>
                                                            <div class="form-group col-sm-12" id="CekimYeriHata">
                                                                <label class="form-label" for="CekimYeri">Çekim Yeri</label>
                                                                <input type="text" id="CekimYeri" class="form-control form-control-sm" name="CekimYeri" maxlength="50">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div id="panel-1" class="panel">
                                                            <div class="card-header py-1" id="CekimPersonelIdHata">
                                                                <h5 style="padding-top:5px">
                                                                    Personeller
                                                                </h5>
                                                            </div>
                                                            <div class="panel-container show">
                                                                <div class="panel-content" id="personellist">
                                                                    <div id="personeller_liste">
                                                                        <div class="input-group mb-g sticky-top bg-faded">
                                                                            <!-- üstte sabitlemek için class a "sticky-top bg-faded" eklendi -->
                                                                            <input type="text" class="form-control form-control form-control-sm shadow-inset-2" id="personeller_liste_arama" placeholder="Personel ara">
                                                                            <div class="input-group-append">
                                                                                <div class="input-group-text">
                                                                                    <i class="fal fa-search fs-sm"></i>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <ul class="list-group" id="PersonelListesi">
                                                                            @foreach (var personel in personeller)
                                                                            {
                                                                                <li class="list-group-item-changed">
                                                                                    <div class="custom-control custom-checkbox">
                                                                                        <input type="checkbox" class="custom-control-input" id="cekim-@personel.Id" data-spersid="cekim-@personel.Id">
                                                                                        <label class="custom-control-label" data-filter-tags="@personel.AdiSoyadi.ToLower()" for="cekim-@personel.Id">@personel.AdiSoyadi - @personel.PersonelGorevleri.Gorev</label>
                                                                                    </div>
                                                                                </li>
                                                                            }
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-sm-4" style="margin: auto auto;">
                                                        <button type="button" class="btn btn-sm btn-primary btn-block waves-effect waves-themed" id="CekimEkle">
                                                            Randevu Ekle
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel-content">
                                                <table class="table table-bordered table-sm table-responsive-sm table-hover m-0 mb-2" id="tb-cekimrandeulari">
                                                    <thead class="thead-themed">
                                                        <tr>
                                                            @*<th class="text-center">#</th>*@
                                                            <th>Tarih</th>
                                                            <th>Zaman</th>
                                                            <th>Açıklama</th>
                                                            <th>Personel</th>
                                                            <th>İşlem</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="cekimrandevu-satir">
                                                        @if (CekimRandevulari.Count > 0)
                                                        {
                                                            foreach (var randevu in CekimRandevulari)
                                                            {
                                                                List<RandevuToPersonel> cekimpersonel = dbContext.RandevuToPersonels.Where(x => x.RandevuId == randevu.Id).ToList();
                                                                string cekimpersonelleri = "";
                                                                foreach (RandevuToPersonel randevupers in cekimpersonel)
                                                                {
                                                                    cekimpersonelleri = cekimpersonelleri + randevupers.Personel.AdiSoyadi + " - " + randevupers.Personel.PersonelGorevleri.Gorev + "<br />";
                                                                }

                                                                if (randevu.Iptal == true)
                                                                {


                                                                    <tr>

                                                                        <td>@randevu.Baslangic.ToShortDateString()</td>
                                                                        <td>@randevu.Baslangic.ToShortTimeString() - @randevu.Bitis.ToShortTimeString()</td>
                                                                        <td>@Html.Raw(randevu.Aciklama)</td>
                                                                        <td>@Html.Raw(cekimpersonelleri) </td>
                                                                        <td class="text-center">
                                                                            <a href="#" class="btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms" title="Bilgilendirme SMS'i Gönder" data-cekimid=@randevu.Id data-cekimtarih=@randevu.Baslangic.ToShortDateString() data-cekimbaslama=@randevu.Baslangic.ToShortTimeString() data-cekimbitis=@randevu.Bitis.ToShortTimeString()>
                                                                                <i class="fal fa-mobile-alt"></i>
                                                                            </a>
                                                                            <a href="#" class="btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil" title="Randevuyu Sil" data-cekimid=@randevu.Id data-cekimtarih=@randevu.Baslangic.ToShortDateString() data-cekimbaslama=@randevu.Baslangic.ToShortTimeString() data-cekimbitis=@randevu.Bitis.ToShortTimeString()>
                                                                                <i class="fal fa-trash-alt"></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                                else
                                                                {
                                                                    <tr>
                                                                        <td>@randevu.Baslangic.ToShortDateString()</td>
                                                                        <td>@randevu.Baslangic.ToShortTimeString() - @randevu.Bitis.ToShortTimeString()</td>
                                                                        <td>@Html.Raw(randevu.Aciklama)</td>
                                                                        <td>@Html.Raw(cekimpersonelleri) </td>
                                                                        <td class="text-center">
                                                                            <a href="#" class="btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms" title="Bilgilendirme SMS'i Gönder" data-cekimid=@randevu.Id data-cekimtarih=@randevu.Baslangic.ToShortDateString() data-cekimbaslama=@randevu.Baslangic.ToShortTimeString() data-cekimbitis=@randevu.Bitis.ToShortTimeString()>
                                                                                <i class="fal fa-mobile-alt"></i>
                                                                            </a>
                                                                            <a href="#" class="btn btn-xs btn-info btn-icon mr-1 cekimranduevuiptal" title="Randevuyu İptal Et" data-cekimid=@randevu.Id data-cekimtarih=@randevu.Baslangic.ToShortDateString() data-cekimbaslama=@randevu.Baslangic.ToShortTimeString() data-cekimbitis=@randevu.Bitis.ToShortTimeString()>
                                                                                <i class="fal fa-times-circle"></i>
                                                                            </a>
                                                                            <a href="#" class="btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil" title="Randevuyu Sil" data-cekimid=@randevu.Id data-cekimtarih=@randevu.Baslangic.ToShortDateString() data-cekimbaslama=@randevu.Baslangic.ToShortTimeString() data-cekimbitis=@randevu.Bitis.ToShortTimeString()>
                                                                                <i class="fal fa-trash-alt"></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            }
                                                        }
                                                        else
                                                        {
                                                            <tr>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                                <div class="col col-3 col-lg-3 bg-danger-50"> İptal Randevu Görünümü</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                @*<div class="form-check-inline">
                                        <button type="button" class="btn btn-primary waves-effect waves-themed" id="CekimRandevuGeri">
                                            <i class="fal fa-arrow-alt-left ml-1"></i>
                                            Geri
                                        </button>
                                    </div>*@
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="CekimRandevuDevam">
                                        Değişiklikleri Kaydet
                                        <i class="fal fa-save ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="TabPanel-OdemeBilgileri" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Alınan Ödemeler
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content">
                                                <div class="row">
                                                    <div class="form-group col-sm-4">
                                                        <label class="form-label" for="OdemeTarihi">Tarih</label>
                                                        <div class="input-group">
                                                            <input type="text" class="form-control form-control-sm" value="07/17/2020" id="OdemeTarihi">
                                                            <div class="input-group-append">
                                                                <span class="input-group-text fs-sm">
                                                                    <i class="fal fa-calendar-alt"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-sm-4" id="OdemeTutarHata">
                                                        <label class="form-label" for="OdemeTutar">Tutar</label>
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm" name="OdemeTutar" maxlength="50" id="OdemeTutar">
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm" name="OdemeTutar" maxlength="50" id="SilinenTutar" style="display:none">
                                                    </div>
                                                    <div class="form-group col-sm-4">
                                                        <label class="form-label" for="OdemeSekli">Ödeme Şekli</label>
                                                        <select class="custom-select form-control custom-select-sm" id="OdemeSekli" name="OdemeSekli" title="Ödeme Şeklini Seçiniz.">
                                                            <option selected="" value="1">Nakit</option>
                                                            <option value="2">Kredi Kartı</option>
                                                            <option value="3">Banka Havalesi</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="form-group col-sm-9">
                                                        <label class="form-label" for="OdemeAciklama">Açıklama</label>
                                                        <input type="text" id="OdemeAciklama" class="form-control form-control-sm" name="OdemeAciklama" maxlength="50">
                                                    </div>
                                                    <div class="form-group col-sm-3" style="margin: auto auto;">
                                                        <button type="button" class="btn btn-sm btn-outline-primary waves-effect waves-themed" id="OdemeAl">
                                                            Ekle
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel-content">
                                                <input type="text" id="OdemelerToplam" style="display:none" value="@AlinanOdemeler.Where(x=>x.Iptal==false).Sum(x=>x.Tutar)">
                                                <table class="table table-bordered table-sm table-responsive-sm table-hover m-0 mb-2" id="tb-alinanodemeler">
                                                    <thead class="thead-themed">
                                                        <tr>
                                                            @*<th class="text-center">#</th>*@
                                                            <th class="text-center">Tarih</th>
                                                            <th class="text-center">Tutar</th>
                                                            <th class="text-center">Açıklama</th>
                                                            <th class="text-center">İşlem</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="alinanodemeler-satir">
                                                        @if (AlinanOdemeler.Count > 0)
                                                        {
                                                            foreach (var odeme in AlinanOdemeler)
                                                            {
                                                                if (odeme.Iptal == true)
                                                                {
                                                                    <tr class='bg-danger-50'>
                                                                        <td class="text-center">@odeme.Tarih.ToShortDateString()</td>
                                                                        <td class="text-right">@odeme.Tutar.ToString("C").Replace("₺", "") TL</td>
                                                                        <td class="text-center">@odeme.Notlar</td>
                                                                        <td class="text-center">
                                                                            @*<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 makbuzyazdir' data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar title='Makbuz Yazdır'>
                                                                                    <i class='fal fa-print'></i>
                                                                                </a>*@
                                                                            <a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemesmsgonder' data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='SMS Gönder'>
                                                                                <i class='fal fa-mobile-alt'></i>
                                                                            </a>
                                                                            @*<a href='#' class='btn btn-xs btn-info btn-icon mr-1 odemeiptal' data-odemelergelecekid=@odeme.OdemelerGelecekId data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar title='Ödemeyi İptal Et'>
                                                                                    <i class='fal fa-times-circle'></i>
                                                                                </a>*@
                                                                            <a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid=@odeme.GelecekOdemeID data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") data-iptal=@odeme.Iptal title='Ödemeyi Sil'>
                                                                                <i class='fal fa-trash-alt'></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                                else
                                                                {
                                                                    <tr>
                                                                        <td class="text-center">@odeme.Tarih.ToShortDateString()</td>
                                                                        <td class="text-right alinanodemeler-satir">@odeme.Tutar.ToString("C").Replace("₺", "") TL</td>
                                                                        <td class="text-center">@odeme.Notlar</td>
                                                                        <td class="text-center">
                                                                            <a href='#' class='btn btn-xs btn-primary btn-icon mr-1 makbuzyazdir' data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='Makbuz Yazdır'>
                                                                                <i class='fal fa-print'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemesmsgonder' data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='SMS Gönder'>
                                                                                <i class='fal fa-mobile-alt'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-info btn-icon mr-1 odemeiptal' data-odemelergelecekid=@odeme.GelecekOdemeID data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='Ödemeyi İptal Et'>
                                                                                <i class='fal fa-times-circle'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid=@odeme.GelecekOdemeID data-odemeid=@odeme.Id data-odemetarih=@odeme.Tarih.ToShortDateString() data-odemetutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") data-iptal=@odeme.Iptal title='Ödemeyi Sil'>
                                                                                <i class='fal fa-trash-alt'></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            }
                                                        }
                                                        else
                                                        {
                                                            <tr>
                                                                <td class="text-center"></td>
                                                                <td class="text-right alinanodemeler-satir"></td>
                                                                <td class="text-center"></td>
                                                                <td class="text-center"></td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                                <div class="alert alert-primary" role="alert">
                                                    <table class="table table-sm table-responsive-sm m-0">
                                                        <tbody>
                                                            <tr>
                                                                <td class="text-right w-75 fw-700">Sözleşme Tutarı:</td>
                                                                <td class="text-right w-25 fw-700" id="sozlesmetutari">0,00 TL</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="text-right w-75 fw-700">Yapılan Ödemeler Toplamı:</td>
                                                                <td class="text-right w-25 fw-700" id="Odemetoplam">0,00 TL</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="text-right w-75 fw-700">Kalan Ödemeler Toplamı:</td>
                                                                <td class="text-right w-25 fw-700" id="kalanodemetoplam">@Convert.ToDecimal(GelecekOdemeler.Where(x => x.OdemeAl == false).Sum(x => x.Tutar)).ToString("C").Replace("₺", "") TL</td>
                                                                @*<td class="text-right w-25 fw-700" id="kalanodemetoplam">@GelecekOdemeler.Where(x => x.OdemeAl == false).Sum(x => x.Tutar).ToString("C").Replace("₺", "TL")</td>*@
                                                            </tr>
                                                            <tr>
                                                                <td class="text-right w-75 fw-700">Sözleşme Kalan:</td>
                                                                <td class="text-right w-25 fw-700" id="sozlesmekalan">0,00 TL</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col col-5 col-lg-5 bg-danger-50"> İptal Ödeme Görünümü</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div id="panel-1" class="panel">
                                        <div class="card-header py-1">
                                            <h5 style="padding-top:5px">
                                                Kalan Ödemler / Taksitler
                                            </h5>
                                        </div>
                                        <div class="panel-container show">
                                            <div class="panel-content">
                                                <div class="row">
                                                    <div class="form-group col-sm-4">
                                                        <label class="form-label" for="KalanOdemeTarihi">Ödeme Tarihi</label>
                                                        <div class="input-group">
                                                            <input type="text" class="form-control form-control-sm" value="07/17/2020" id="KalanOdemeTarihi">
                                                            <div class="input-group-append">
                                                                <span class="input-group-text fs-sm">
                                                                    <i class="fal fa-calendar-alt"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-sm-3" id="KalanTutarHata">
                                                        <label class="form-label" for="KalanOdemeTutar">Tutar</label>
                                                        <input type="text" placeholder="0.00" data-inputmask="'alias': 'currency'" class="form-control form-control-sm" name="KalanOdemeTutar" maxlength="50" id="KalanOdemeTutar">
                                                    </div>
                                                    <div class="form-group col-sm-3">
                                                        <label class="form-label" for="KalanOdemeAciklama">Açıklama</label>
                                                        <input type="text" id="KalanOdemeAciklama" class="form-control form-control-sm" name="KalanOdemeAciklama" maxlength="50">
                                                    </div>
                                                    <div class="form-group col-sm-2" style="margin: auto auto;">
                                                        <button type="button" class="btn btn-sm btn-outline-primary waves-effect waves-themed" id="AlacakEkle">
                                                            Ekle
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel-content">
                                                <input type="text" id="AlacaklarToplam" style="display:none" value="@GelecekOdemeler.Where(x=>x.OdemeAl==false).Sum(x=>x.Tutar)">
                                                <table class="table table-bordered table-sm table-responsive-sm table-hover m-0 mb-2" id="tb-gelecekodemeler">
                                                    <thead class="thead-themed">
                                                        <tr>
                                                            <th class="text-center">Ödeme Tarihi</th>
                                                            <th class="text-center">Tutar</th>
                                                            <th class="text-center">Açıklama</th>
                                                            <th class="text-center">İşlem</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="gelecekodemeler-satir">
                                                        @if (GelecekOdemeler.Count > 0)
                                                        {
                                                            foreach (var odeme in GelecekOdemeler)
                                                            {
                                                                if (odeme.OdemeAl == true)
                                                                {
                                                                    <tr id="gelecekodemeid-@odeme.Id" class='bg-primary-50'>
                                                                        <td class="text-center">@odeme.OdemeTarihi.ToShortDateString()</td>
                                                                        <td class="text-right">@odeme.Tutar.ToString("C").Replace("₺", "") TL</td>
                                                                        <td class="text-center">@odeme.Notlar</td>
                                                                        <td class="text-center">
                                                                            <a href='#' class='btn btn-xs btn-primary btn-icon mr-1 disabled alacaksmsgonder' data-alacakid=@odeme.Id data-alacaktarih=@odeme.Tarih.ToShortDateString() data-alacaktutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='SMS Gönder'>
                                                                                <i class='fal fa-mobile-alt'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-success btn-icon mr-1 disabled odemeal' data-alacakid=@odeme.Id data-alacaktarih=@odeme.Tarih.ToShortDateString() data-alacaktutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='Ödeme Al'>
                                                                                <i class='fal fa-plus-octagon'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-danger btn-icon mr-1 disabled alacaksil' data-alacakid=@odeme.Id data-alacaktarih=@odeme.Tarih.ToShortDateString() data-alacaktutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='Borcu Sil'>
                                                                                <i class='fal fa-trash-alt'></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                                else
                                                                {
                                                                    <tr id="gelecekodemeid-@odeme.Id">
                                                                        <td class="text-center">@odeme.OdemeTarihi.ToShortDateString()</td>
                                                                        <td class="text-right">@odeme.Tutar.ToString("C").Replace("₺", "") TL</td>
                                                                        <td class="text-center">@odeme.Notlar</td>
                                                                        <td class="text-center">
                                                                            <a href='#' class='btn btn-xs btn-primary btn-icon mr-1 alacaksmsgonder' data-alacakid=@odeme.Id data-alacaktarih=@odeme.Tarih.ToShortDateString() data-alacaktutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='SMS Gönder'>
                                                                                <i class='fal fa-mobile-alt'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemeal' data-alacakid=@odeme.Id data-alacaktarih=@odeme.Tarih.ToShortDateString() data-alacaktutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='Ödeme Al'>
                                                                                <i class='fal fa-plus-octagon'></i>
                                                                            </a>
                                                                            <a href='#' class='btn btn-xs btn-danger btn-icon mr-1 alacaksil' data-alacakid=@odeme.Id data-alacaktarih=@odeme.Tarih.ToShortDateString() data-alacaktutar=@odeme.Tutar.ToString("C").Replace("₺", "TL") title='Borcu Sil'>
                                                                                <i class='fal fa-trash-alt'></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            }
                                                        }
                                                        else
                                                        {
                                                            <tr>
                                                                <td class="text-center"></td>
                                                                <td class="text-right"></td>
                                                                <td class="text-center"></td>
                                                                <td class="text-center"></td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                                <div class="alert alert-primary" role="alert">
                                                    <table class="table table-sm table-responsive-sm m-0">
                                                        <tbody>
                                                            <tr>
                                                                <td class="text-right w-75 fw-700">Kalan Ödemeler Toplamı:</td>
                                                                <td class="text-right w-25 fw-700" id="kalanodemetoplam2">@GelecekOdemeler.Where(x => x.OdemeAl == false).Sum(x => x.Tutar).ToString("C").Replace("₺", "") TL</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col col-5 col-lg-5 bg-primary-50"> Alinan Ödeme Görünümü</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-content d-flex py-2 rounded-bottom border-faded border-left-0 border-right-0 border-bottom-0 text-muted">
                                @*<div class="form-check-inline">
                                        <button type="button" class="btn btn-primary waves-effect waves-themed" id="OdemelerGeri">
                                            <i class="fal fa-arrow-alt-left ml-1"></i>
                                            Geri
                                        </button>
                                    </div>*@
                                <div class="form-check-inline ml-auto">
                                    <button type="button" class="btn btn-primary waves-effect waves-themed" id="OdemelerSozlesmeGoruntule">
                                        Sözleşmeyi Görüntüle
                                        <i class="fal fa-file-alt ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Script
{
    <script>
        initApp.listFilter($('#paketler_liste'), $('#paketler_liste_arama'));
        initApp.listFilter($('#hizmetler_liste'), $('#hizmetler_liste_arama'));
        initApp.listFilter($('#surecler_liste'), $('#surecler_liste_arama'));
        initApp.listFilter($('#sozlesmepersonellist'), $('#sozlesme_personeller_liste_arama'));
        initApp.listFilter($('#personellist'), $('#personeller_liste_arama'));
        // Tab Menüleri Aktif Pasif Fonksiyonları
        function RezervasyonBilgileriAktif() {
            $("#Tab-RezervasyonBilgileri").addClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#TabPanel-RezervasyonBilgileri").addClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "true");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");
        };
        function MusteriBilgileriAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").addClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "true");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").addClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");
        };
        function DigerBilgilerAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").addClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "true");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").addClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");
        };
        function PaketVeEkhizmetlerAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").addClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "true");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").addClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");
        };
        function SureclerAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").addClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "true");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").addClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");
        };
        function CekimRandevuAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").addClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "true");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").addClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");
        };
        function OdemeBilgileriAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").addClass("active");
            $("#Tab-SozlesmeOnizleme").removeClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "true");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "false");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").addClass("active show");
            $("#TabPanel-SozlesmeOnizleme").removeClass("active show");
        };
        function SozlesmeOnizlemeAktif() {
            $("#Tab-RezervasyonBilgileri").removeClass("active");
            $("#Tab-MusteriBilgileri").removeClass("active");
            $("#Tab-DigerBilgiler").removeClass("active");
            $("#Tab-PaketVeEkhizmetler").removeClass("active");
            $("#Tab-Surecler").removeClass("active");
            $("#Tab-CekimRandevu").removeClass("active");
            $("#Tab-OdemeBilgileri").removeClass("active");
            $("#Tab-SozlesmeOnizleme").addClass("active");

            $("#Tab-RezervasyonBilgileri").attr("aria-selected", "false");
            $("#Tab-MusteriBilgileri").attr("aria-selected", "false");
            $("#Tab-DigerBilgiler").attr("aria-selected", "false");
            $("#Tab-PaketVeEkhizmetler").attr("aria-selected", "false");
            $("#Tab-Surecler").attr("aria-selected", "false");
            $("#Tab-CekimRandevu").attr("aria-selected", "false");
            $("#Tab-OdemeBilgileri").attr("aria-selected", "false");
            $("#Tab-SozlesmeOnizleme").attr("aria-selected", "true");

            $("#TabPanel-RezervasyonBilgileri").removeClass("active show");
            $("#TabPanel-MusteriBilgileri").removeClass("active show");
            $("#TabPanel-DigerBilgiler").removeClass("active show");
            $("#TabPanel-PaketVeEkhizmetler").removeClass("active show");
            $("#TabPanel-Surecler").removeClass("active show");
            $("#TabPanel-CekimRandevu").removeClass("active show");
            $("#TabPanel-OdemeBilgileri").removeClass("active show");
            $("#TabPanel-SozlesmeOnizleme").addClass("active show");
        };
        function BilgiMesaji(sonuc) {
            if (sonuc == true) {
                Command: toastr["success"]("Değişiklikler Başarıyla Kaydedildi")

                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-top-center",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": 300,
                    "hideDuration": 100,
                    "timeOut": 1000,
                    "extendedTimeOut": 1000,
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
            }
            else {
                Command: toastr["error"]("Kayıtlar Değiştirilemedi ", "HATA")

                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-top-center",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": 300,
                    "hideDuration": 100,
                    "timeOut": 2000,
                    "extendedTimeOut": 1000,
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
            }
        }
        function dateFormat(d) {
            return (d.getDate() + "").padStart(2, "0") + "." + ((d.getMonth() + 1) + "").padStart(2, "0") + "." + d.getFullYear();
        }
        function timeFormat(t) {
            var saat = t.getHours();
            var dakika = t.getMinutes();
            if (saat < 10) {
                saat = "0" + saat;
            }
            if (dakika < 10) {
                dakika = "0" + dakika;
            }
            var zaman = saat + ":" + dakika
            return zaman;
        }
        function ParaFormat(fiyat) {
            var para_sembol = "TL"
            var format = new Intl.NumberFormat('de-DE', {
                style: 'currency',
                currency: 'TRY',
                minumumFractionDigits: 2
            })
            //return format.format(fiyat)
            return format.format(fiyat).replace('TRY', para_sembol)
        }
        function SureclerYukle() {
            var sec = $("input[type=checkbox]");
            $.each(sec, function (index, item) {
                if (($(this).is(":disabled") == false)) {
                    $(item).prop("checked", true);
                    $(item).prop("checked", false);
                }
            }); // Tüm süreçlerdeki tikler kaldırılıyor
            var idler = $(this).data("sureclerid");
            var sozlesmeid = $(this).data("sozlesmeid");
            surecGuncelleSecilenID = [];

            if (typeof (idler) === 'number') {
                surecGuncelleSecilenID.push(idler);
            }
            else {
                surecGuncelleSecilenID = idler.split(",");
            }

            for (var i = 0; i < surecGuncelleSecilenID.length; i++) {
                var Secici = "#surecguncelle" + surecGuncelleSecilenID[i];
                $(Secici).prop("checked", true);
            }
        };
        var controls = {
            leftArrow: '<i class="fal fa-angle-left" style="font-size: 1.25rem"></i>',
            rightArrow: '<i class="fal fa-angle-right" style="font-size: 1.25rem"></i>'
        }
        var runDatePicker = function () {
            $('#SozlesmeTarihi').datepicker(
                {
                    todayBtn: "linked",
                    todayHighlight: true,
                    templates: controls,
                    language: 'tr',
                    autoclose: true
                }).datepicker("setDate", new Date());
            $('#OpsiyonTarihi').datepicker(
                {
                    todayBtn: "linked",
                    todayHighlight: true,
                    templates: controls,
                    language: 'tr',
                    autoclose: true
                }).datepicker("setDate", new Date());
            $('#RezervasyonTarihi').datepicker(
                {
                    todayBtn: "linked",
                    todayHighlight: true,
                    templates: controls,
                    language: 'tr',
                    autoclose: true
                }).datepicker("setDate", new Date());
            $('#OdemeTarihi').datepicker(
                {
                    todayBtn: "linked",
                    todayHighlight: true,
                    templates: controls,
                    language: 'tr',
                    autoclose: true
                }).datepicker("setDate", new Date());
            $('#KalanOdemeTarihi').datepicker(
                {
                    todayBtn: "linked",
                    todayHighlight: true,
                    templates: controls,
                    language: 'tr',
                    autoclose: true
                }).datepicker("setDate", new Date());
            $('#CekimTarihi').datepicker(
                {
                    todayBtn: "linked",
                    todayHighlight: true,
                    templates: controls,
                    language: 'tr',
                    autoclose: true
                }).datepicker("setDate", new Date());
        }
        var sozlesmeId; var sozlesmeNo; var musteriid = 0; var randevuId;
        $(":input").inputmask();

        $('#slimtest1').slimScroll(
            {
                position: 'right',
                height: '250px',
                railVisible: true,
                alwaysVisible: true
            });
        $('#slimtest2').slimScroll(
            {
                position: 'right',
                height: '250px',
                railVisible: true,
                alwaysVisible: true
            });
        $('#slimtest3').slimScroll(
            {
                position: 'right',
                height: '250px',
                railVisible: true,
                alwaysVisible: true
            });
        $('#slimtest4').slimScroll(
            {
                position: 'right',
                height: '250px',
                railVisible: true,
                alwaysVisible: true
            });
        $('#slimtest5').slimScroll(
            {
                position: 'right',
                height: '350px',
                railVisible: true,
                alwaysVisible: true
            });
        $('#sozlesmepersonellist').slimScroll(
            {
                position: 'right',
                height: '250px',
                railVisible: true,
                alwaysVisible: true
            });
        $("#PaketTutar").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $("#Iskonto").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $("#EkHizmetTutar").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $("#ToplamTutar").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $("#OdemeTutar").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $("#KalanOdemeTutar").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $("#SilinenTutar").inputmask("currency",
            {
                placeholder: "0.00", // Varsayılan değer
                prefix: "", // öndeki değer
                suffix: " TL", // sondaki değer
                rightAlign: false, // sağa-sola yaslama
                radixPoint: ",", // kuruş ayıracı
                groupSeparator: "." // binlik ayıracı
            });
        $(document).ready(function () {
            var SozlesmePersonelIdArray = new Array();
            var RandevuPersonelIdArray = new Array();
            runDatePicker();
            RezervasyonBilgileriAktif();
            sozlesmeId = $("#SozlesmeId").val();
            sozlesmeNo = $("#SozlesmeNo").val();
            musteriid = $("#MusteriIdVT").val();
            $('#SozlesmeTarihi').datepicker("setDate", $("#SozlesmeTarihiVT").val());
            $('#RezervasyonTarihi').datepicker("setDate", $("#RezervasyonTarihiVT").val());
            $('#PaketTutar').val($("#PaketTutarVT").val());
            $('#EkHizmetTutar').val($("#EkHizmetTutarVT").val());
            $('#Iskonto').val($("#IskontoVT").val());
            $('#ToplamTutar').val($("#ToplamTutarVT").val());
            if ($("#OpsiyonTarihiVT").val() != "01.01.0001") {
                $('#OpsiyonTarihi').datepicker("setDate", $("#OpsiyonTarihiVT").val());
            }
            else {
                $("#OpsiyonTarihi").datepicker("setDate", new Date());
            }
            $(function () {
                if ($("#RezervasyonTurId").find("option:selected").data("formalan") == "Gelin/Damat") {
                    $(".Gelin").removeAttr("style", "display:none");
                    $(".Damat").removeAttr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($("#RezervasyonTurId").find("option:selected").data("formalan") == "Bebek/Çocuk") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").removeAttr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($("#RezervasyonTurId").find("option:selected").data("formalan") == "Ürün/Katalog") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").removeAttr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($("#RezervasyonTurId").find("option:selected").data("formalan") == "Model/Manken") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").removeAttr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($("#RezervasyonTurId").find("option:selected").data("formalan") == "Yetkili") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").removeAttr("style", "display:none");
                }
                else {
                    $(".Gelin").removeAttr("style", "display:none");
                    $(".Damat").removeAttr("style", "display:none");
                    $(".BebekCocuk").removeAttr("style", "display:none");
                    $(".UrunKatalog").removeAttr("style", "display:none");
                    $(".ModelManken").removeAttr("style", "display:none");
                    $(".Yetkili").removeAttr("style", "display:none");
                }
            });
            $(function () {
                $('#MusteriId').select2();
            });
            var secilenpaketidleri = $(".secilenpaketidleri");
            var paketler = $(".paketler");
            var secilenekhizmetidleri = $(".secilenekhizmetidleri");
            var ekhizmetler = $(".ekhizmetler");
            var secilensurecidleri = $(".secilensurecidleri");
            var surecler = $(".surecler");
            $.each(secilenpaketidleri, function (index, item) {
                var secilenid = item.value;
                $.each(paketler, function (index, item) {
                    var paketid = $(this).data("paketid");
                    var secici = ".paketler-" + paketid
                    if (secilenid == paketid) {
                        $(".paketler-" + paketid).attr("checked", "checked");
                    }
                });
            });
            $.each(secilenekhizmetidleri, function (index, item) {
                var secilenid = item.value;
                $.each(ekhizmetler, function (index, item) {
                    var ekhizmetid = $(this).data("ekhizmetid");
                    if (secilenid == ekhizmetid) {
                        $(".ekhizmetler-" + ekhizmetid).attr("checked", "checked");
                    }
                });
            });
            $.each(secilensurecidleri, function (index, item) {
                var secilenid = item.value;
                $.each(surecler, function (index, item) {
                    var surecid = $(this).data("surecid");
                    if (secilenid == surecid) {
                        $(".Surecler-" + surecid).attr("checked", "checked");
                    }
                });
            });

            $("#PersonelId").change(function () {
                PersonelIzinKontrol()
            });
            $("#RezervasyonTarihi").change(function () {
                PersonelIzinKontrol();
                TatilGunuKontrol();
            });
            // ------  Personel İzin Kontrolü
            // ------  Rezervasyon Sekli seçimi
            $("#RezervasyonSekliId").change(function () {
                var rezervasyonsekli = $(this).find("option:selected").val();
                if (rezervasyonsekli == 1) {
                    $("#OpsiyonTarihi").attr("disabled", "true");
                }
                else {
                    $("#OpsiyonTarihi").removeAttr("disabled");
                }
            });
            // ------  Rezervasyon Sekli seçimi
            // ------  Rezervasyon Türü değiştiğinde Diğre Bilgilerdeki Textler Boşaltılacak.
            $("#RezervasyonTurId").change(function () {
                $("#GelinAdSoyad").val("");
                $("#GelinCep").val("");
                $("#GelinEmail").val("");
                $("#DamatAdSoyad").val("");
                $("#DamatCep").val("");
                $("#DamatEmail").val("");
                $("#BebekAdSoyad").val("");
                $("#BabaAdSoyad").val("");
                $("#AnneAdSoyad").val("");
                $("#BabaCep").val("");
                $("#AnneCep").val("");
                $("#BabaEmail").val("");
                $("#Urunler").val("");
                $("#UrunYetkiliAdSoyad").val("");
                $("#UrunYetkiliCep").val("");
                $("#UrunYetkiliEmail").val("");
                $("#Modeller").val("");
                $("#ModelYetkiliAdSoyad").val("");
                $("#ModelYetkiliCep").val("");
                $("#ModelYetkiliEmail").val("");
                $("#YetkiliAdSoyad").val("");
                $("#YetkiliCep").val("");
                $("#YetkiliEmail").val("");
            });
            // ------  Rezervasyon Türü değiştiğinde Diğre Bilgilerdeki Textler Boşaltılacak.
            // ------  Zaman Dilimi seçimi
            $("#ZamanDilimiId").change(function () {
                var zamandilimi = $(this).find("option:selected").val();
                if (zamandilimi != 0) {
                    $("#BaslangicZaman").attr("disabled", "true");
                    $("#BitisZaman").attr("disabled", "true")
                }
                else {
                    $("#BaslangicZaman").removeAttr("disabled");
                    $("#BitisZaman").removeAttr("disabled");
                }
            });
            // ------  Zaman Dilimi seçimi

            // ------  Rezervasyon Türü seçimi
            $("#RezervasyonTurId").change(function () {
                if ($(this).find("option:selected").data("formalan") == "Gelin/Damat") {
                    $(".Gelin").removeAttr("style", "display:none");
                    $(".Damat").removeAttr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($(this).find("option:selected").data("formalan") == "Bebek/Çocuk") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").removeAttr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($(this).find("option:selected").data("formalan") == "Ürün/Katalog") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").removeAttr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($(this).find("option:selected").data("formalan") == "Model/Manken") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").removeAttr("style", "display:none");
                    $(".Yetkili").attr("style", "display:none");
                }
                else if ($(this).find("option:selected").data("formalan") == "Yetkili") {
                    $(".Gelin").attr("style", "display:none");
                    $(".Damat").attr("style", "display:none");
                    $(".BebekCocuk").attr("style", "display:none");
                    $(".UrunKatalog").attr("style", "display:none");
                    $(".ModelManken").attr("style", "display:none");
                    $(".Yetkili").removeAttr("style", "display:none");
                }
                else {
                    $(".Gelin").removeAttr("style", "display:none");
                    $(".Damat").removeAttr("style", "display:none");
                    $(".BebekCocuk").removeAttr("style", "display:none");
                    $(".UrunKatalog").removeAttr("style", "display:none");
                    $(".ModelManken").removeAttr("style", "display:none");
                    $(".Yetkili").removeAttr("style", "display:none");
                }
            });
            // ------   Rezervasyon Türü seçimi

            // ------ Müşteri Listesinde Müşteri seçimi
            $("#MusteriId").change(function () {
                musteriid = $(this).find("option:selected").val();
                var musterikodu = $(this).find("option:selected").data("musterikodu");
                var adsoyad = $(this).find("option:selected").data("adsoyad");
                var tckimlik = $(this).find("option:selected").data("tckimlikno");
                var email = $(this).find("option:selected").data("email");
                var ceptel = $(this).find("option:selected").data("ceptel");
                var sabittel = $(this).find("option:selected").data("sabittel");
                var adres = $(this).find("option:selected").data("adres");
                var notlar = $(this).find("option:selected").data("notlar");
                if (musteriid != 0) {
                    adres = adres.replace(/\<br \/\>/g, "\r\n");
                    notlar = notlar.replace(/\<br \/\>/g, "\r\n");
                    $("#MusteriKodu").val(musterikodu);
                    $("#AdSoyad").val(adsoyad);
                    $("#TCKimlikNo").val(tckimlik);
                    $("#Email").val(email);
                    $("#CepTel").val(ceptel);
                    $("#SabitTel").val(sabittel);
                    $("#Adres").val(adres);
                    $("#Notlar").val(notlar);

                    $("#AdSoyad").addClass("disabled");
                    $("#TCKimlikNo").addClass("disabled");

                    $("#AdSoyad").attr("disabled", "disabled");
                    $("#TCKimlikNo").attr("disabled", "disabled");
                }
                else {
                    $("#MusteriKodu").val(musterikodu);
                    $("#AdSoyad").val("");
                    $("#TCKimlikNo").val("");
                    $("#Email").val("");
                    $("#CepTel").val("");
                    $("#SabitTel").val("");
                    $("#Adres").val("");
                    $("#Notlar").val("");

                    $("#AdSoyad").removeClass("disabled");
                    $("#TCKimlikNo").removeClass("disabled");

                    $("#AdSoyad").removeAttr("disabled");
                    $("#TCKimlikNo").removeAttr("disabled");
                }
            });
            // ------ Müşteri Listesinde Müşteri seçimi

            // ------  Paket ve EkHizmetler Sekmesi hesaplama ve yazma işlemleri  ------ //
            var OdemeAlDurum = false;
            var formattedOutput = new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 2,
            });
            var ToplamTutar = $("#ToplamTutarVT").val().replace(" TL", "");
            ToplamTutar = ToplamTutar.replace(".", "");
            ToplamTutar = ToplamTutar.replace(",", ".");
            var paketfiyat = 0;
            var toplampaketfiyat = $("#PaketTutarVT").val().replace(" TL", "");
            toplampaketfiyat = toplampaketfiyat.replace(".", "");
            toplampaketfiyat = toplampaketfiyat.replace(",", ".");
            var ekhizmetfiyat = 0;
            var toplamekhizmetfiyat = $("#EkHizmetTutarVT").val().replace(" TL", "");
            toplamekhizmetfiyat = toplamekhizmetfiyat.replace(".", "");
            toplamekhizmetfiyat = toplamekhizmetfiyat.replace(",", ".");
            var iskonto = $("#IskontoVT").val().replace(" TL", "");
            iskonto = iskonto.replace(".", "");
            iskonto = iskonto.replace(",", ".");

            var alacaktoplam = $("#AlacaklarToplam").val().replace(" TL", "");
            alacaktoplam = alacaktoplam.replace(".", "");
            alacaktoplam = alacaktoplam.replace(",", ".");

            var odemetoplam = $("#OdemelerToplam").val().replace(" TL", "");
            odemetoplam = odemetoplam.replace(".", "");
            odemetoplam = odemetoplam.replace(",", ".");

            var toplam = $("#ToplamTutarVT").val().replace(" TL", "");
            toplam = toplam.replace(".", "");
            toplam = toplam.replace(",", ".");

            $("#sozlesmetutari").html(accounting.formatMoney(toplam, "TL", 2, ".", ",", "%v %s"));
            $("#Odemetoplam").html(accounting.formatMoney(odemetoplam, "TL", 2, ".", ",", "%v %s"));

            var kalan;
            if (parseFloat(toplam) == parseFloat(odemetoplam)) {
                kalan = 0;
            }
            else {
                kalan = parseFloat(toplam) - ((parseFloat(odemetoplam) + parseFloat(alacaktoplam)));
            }
            $("#sozlesmekalan").html(accounting.formatMoney(kalan, "TL", 2, ".", ",", "%v %s"));

            var secilenpaketID = [];
            var secilenekhizmetID = [];
            var secilensurecID = [];
            var eskisecilenpaketID = [];
            var eskisecilenekhizmetID = [];
            var eskisecilensurecID = [];
            eskisecilenpaketID = ($("#ModelPaketlerId").val().split(',')).map(Number);
            eskisecilenekhizmetID = ($("#ModelEkHizmetlerId").val().split(',')).map(Number);
            eskisecilensurecID = $("#ModelSureclerId").val();
     
            // ------ Paketler Listesindeki paket seçimi
            var PaketListesi = $("#Paketler :checkbox");
            PaketListesi.on("change", function () {
                    SecilenPaketler();
            });
            //PaketListesi.on("change", function () {
            //    var fiyat = $(this).data("fiyat");
            //    console.log(fiyat);
            //    if ($(this).is(':checked')) {
            //        SecilenPaketler();
            //    }
            //    else {
            //        var index;
            //        if (eskisecilenpaketID.length > secilenpaketID.length) { // eski Id lerden bir tanesi kaldırılınca
            //            eskisecilenpaketID.forEach(function (eskiId) {
            //                index = secilenpaketID.includes(eskiId);                            
            //                if (index) {
            //                    var kb = $("#sozlesmekalan").html();
            //                    kb = kb.replace(" TL", "");
            //                    kb = kb.replace(".", "");
            //                    kb = kb.replace(",", ".");

            //                    var pktfiyat = fiyat.replace("TL", "");
            //                    pktfiyat = pktfiyat.replace(".", "");
            //                    pktfiyat = pktfiyat.replace(",", ".");
                                
            //                    if (parseFloat(kb) == 0 || parseFloat(kb) < parseFloat(pktfiyat)) {
            //                        Swal.fire(
            //                            {
            //                                title: "Paket İptal Edilemez",
            //                                html: "<p style='color:red'> Sözleşme oluşturulduğunda eklenmiş ve Ödeme işlemleri tamamlanmış Paket iptal edilemez!</p>",
            //                                type: "warning",
            //                                confirmButtonText: "Tamam"
            //                            });
            //                        $(this).prop("checked", true);
            //                    }
            //                    else {
            //                        SecilenPaketler();
            //                    }
            //                }
            //                else {
            //                    SecilenEkHizmetler();
            //                }
            //            });
            //        }
            //        else {                                                      // Eskiler haricinde bir tane seçilmiş ve geri kaldırılırsa
            //            secilenpaketID.forEach(function (yeniId) {
            //                index = eskisecilenpaketID.includes(yeniId);
            //                if (index) {
            //                    var kb = $("#sozlesmekalan").html();
            //                    kb = kb.replace(" TL", "");
            //                    kb = kb.replace(".", "");
            //                    kb = kb.replace(",", ".");

            //                    var pktfiyat = fiyat.replace("TL", "");
            //                    pktfiyat = pktfiyat.replace(".", "");
            //                    pktfiyat = pktfiyat.replace(",", ".");

            //                    if (parseFloat(kb) == 0 || parseFloat(kb) == parseFloat(pktfiyat)) {
            //                        Swal.fire(
            //                            {
            //                                title: "Paket İptal Edilemez",
            //                                html: "<p style='color:red'> Sözleşme oluşturulduğunda eklenmiş ve Ödeme işlemleri tamamlanmış Paket iptal edilemez!</p>",
            //                                type: "warning",
            //                                confirmButtonText: "Tamam"
            //                            });
            //                        $(this).prop("checked", true);
            //                    }
            //                    else {
            //                        SecilenPaketler();
            //                    }
            //                }
            //                else {
            //                    SecilenEkHizmetler();
            //                }
            //            });
            //        }
            //    }
            //});
            function SecilenPaketler() {
                secilenpaketID = [];
                $("#slimtest2").empty();
                toplampaketfiyat = 0;
                if (secilenpaketID.length == 0) {
                    paketfiyat = 0;
                    toplampaketfiyat = 0;
                    ToplamTutar = parseFloat(toplampaketfiyat) + parseFloat(toplamekhizmetfiyat);
                    iskonto = $("#Iskonto").val().replace(" TL", "");
                    iskonto = iskonto.replace(".", "");
                    iskonto = iskonto.replace(",", ".");

                    if (iskonto != "") {
                        var ToplamTutar2 = parseFloat(ToplamTutar) - parseFloat(iskonto);
                        var kalantutuar = parseFloat(ToplamTutar2) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#PaketTutar").val(formattedOutput.format(parseFloat(toplampaketfiyat))); // Seçilen Paketlerin Toplamı
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar2))); // paketler sayfası alt toplam 16.000
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası üst sözleşme turatı
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası öedene ve ödenecek tutardan hesaplanacak (sozlesmetutari - (Odemetoplam+kalanodemetoplam))
                    }
                    else {
                        var kalantutuar = parseFloat(ToplamTutar) - (parseFloat(alacaktoplam)  + parseFloat(odemetoplam) );
                        $("#PaketTutar").val(formattedOutput.format(parseFloat(toplampaketfiyat))); // Seçilen Paketlerin Toplamı
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar)));  // paketler sayfası alt toplam 16.000
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası üst sözleşme turatı
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası öedene ve ödenecek tutardan hesaplanacak (sozlesmetutari - (Odemetoplam+kalanodemetoplam))
                    }
                }
                PaketListesi.filter(":checked").each(function () {
                    secilenpaketID.push($(this).data("paketid"));

                    paketfiyat = $(this).data("fiyat").replace("TL", "");
                    paketfiyat = paketfiyat.replace(".", "");
                    paketfiyat = paketfiyat.replace(",", ".");
                    toplampaketfiyat = toplampaketfiyat + parseFloat(paketfiyat);

                    $("#PaketTutar").val(formattedOutput.format(parseFloat(toplampaketfiyat)));
                    $("#slimtest2").append("<div class='alert alert-primary mb-2'>" +
                        "<h5 class='card-title'>" + $(this).val() + "<span class='fw-700'> - " + accounting.formatMoney(paketfiyat, "TL", 2, ".", ",", "%v %s") + "</span></h5>" + $(this).data("paketdetay") +
                        "</div>");
                    ToplamTutar = parseFloat(toplampaketfiyat) + parseFloat(toplamekhizmetfiyat);
                    iskonto = $("#Iskonto").val().replace(" TL", "");
                    iskonto = iskonto.replace(".", "");
                    iskonto = iskonto.replace(",", ".");

                    if (iskonto != "") {
                        var ToplamTutar2 = parseFloat(ToplamTutar) - parseFloat(iskonto);
                        var kalantutuar = parseFloat(ToplamTutar2) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar2))); // paketler sayfası alt toplam 16.000
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));  //ödemeler sayfası üst sözleşme turatı
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası öedene ve ödenecek tutardan hesaplanacak (sozlesmetutari - (Odemetoplam+kalanodemetoplam))
                    }
                    else {
                        var kalantutuar = parseFloat(ToplamTutar) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar))); // paketler sayfası alt toplam 16.000
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar, "TL", 2, ".", ",", "%v %s"));   //ödemeler sayfası üst sözleşme turatı
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası öedene ve ödenecek tutardan hesaplanacak (sozlesmetutari - (Odemetoplam+kalanodemetoplam))
                    }
                });

            }

            // ------ Paketler Listesindeki paket seçimi
            // ------ Ek Hizmetler Listesindeki paket seçimi
            var EkHizmetListesi = $("#EkHizmetler :checkbox");
            EkHizmetListesi.on("change", function () {
                SecilenEkHizmetler();
            });
            //EkHizmetListesi.on("change", function () {
            //    var fiyat = $(this).data("fiyat");
            //    console.log(fiyat);
            //    if ($(this).is(':checked')) {
            //        SecilenEkHizmetler();
            //    }
            //    else {
            //        var index;
            //        if (eskisecilenekhizmetID.length > secilenekhizmetID.length) { // eski Id lerden bir tanesi kaldırılınca
            //            eskisecilenekhizmetID.forEach(function (eskiId) {
            //                index = secilenekhizmetID.includes(eskiId);
            //                if (index) {
            //                    var kb = $("#sozlesmekalan").html();
            //                    kb = kb.replace(" TL", "");
            //                    kb = kb.replace(".", "");
            //                    kb = kb.replace(",", ".");
            //                    var hzmtfiyat = fiyat.replace("TL", "");
            //                    hzmtfiyat = hzmtfiyat.replace(".", "");
            //                    hzmtfiyat = hzmtfiyat.replace(",", ".");

            //                    console.log("hzmtfiyat" + hzmtfiyat);
            //                    console.log("kb" + kb);

            //                    if (parseFloat(kb) == 0 || parseFloat(kb) < parseFloat(hzmtfiyat)) {
            //                        Swal.fire(
            //                            {
            //                                title: "Ek Hizmet İptal Edilemez",
            //                                html: "<p style='color:red'> Sözleşme oluşturulduğunda eklenmiş ve Ödeme işlemleri tamamlanmış Ek Hizmet iptal edilemez!</p>",
            //                                type: "warning",
            //                                confirmButtonText: "Tamam"
            //                            });
            //                        //$(this).prop("checked", true);
            //                    }
            //                    else {
            //                        SecilenEkHizmetler();
            //                    }
            //                }
            //                else {
            //                    SecilenEkHizmetler();
            //                }
            //            });
            //        }
            //        else {                                                      // Eskiler haricinde bir tane seçilmiş ve geri kaldırılırsa
            //            secilenekhizmetID.forEach(function (yeniId) {
            //                index = eskisecilenekhizmetID.includes(yeniId);
            //                if (index) {
            //                    var kb = $("#sozlesmekalan").html();
            //                    kb = kb.replace(" TL", "");
            //                    kb = kb.replace(".", "");
            //                    kb = kb.replace(",", ".");
            //                    var hzmtfiyat = fiyat.replace("TL", "");
            //                    hzmtfiyat = hzmtfiyat.replace(".", "");
            //                    hzmtfiyat = hzmtfiyat.replace(",", ".");

            //                    console.log("hzmtfiyat" + hzmtfiyat);
            //                    console.log("kb" + kb);

            //                    if (parseFloat(kb) == 0 || parseFloat(kb) < parseFloat(hzmtfiyat)) {
            //                        Swal.fire(
            //                            {
            //                                title: "Ek Hizmet İptal Edilemez",
            //                                html: "<p style='color:red'> Sözleşme oluşturulduğunda eklenmiş ve Ödeme işlemleri tamamlanmış Ek Hizmet iptal edilemez!</p>",
            //                                type: "warning",
            //                                confirmButtonText: "Tamam"
            //                            });
            //                        //$(this).prop("checked", true);
            //                    }
            //                    else {
            //                        SecilenEkHizmetler();
            //                    }
            //                }
            //                else {
            //                    SecilenEkHizmetler();
            //                }
            //            });
            //        }
            //    }
            //});
            function SecilenEkHizmetler() {
                secilenekhizmetID = [];
                $("#slimtest4").empty();
                toplamekhizmetfiyat = 0;
                if (secilenekhizmetID.length == 0) {
                    ekhizmetfiyat = 0;
                    toplamekhizmetfiyat = 0;
                    ToplamTutar = parseFloat(toplampaketfiyat) + parseFloat(toplamekhizmetfiyat);
                    iskonto = $("#Iskonto").val().replace(" TL", "");
                    iskonto = iskonto.replace(".", "");
                    iskonto = iskonto.replace(",", ".");

                    if (iskonto != "") {
                        var ToplamTutar2 = parseFloat(ToplamTutar) - parseFloat(iskonto);
                        var kalantutuar = parseFloat(ToplamTutar2) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#EkHizmetTutar").val(formattedOutput.format(parseFloat(toplamekhizmetfiyat)));
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar2)));
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s"));
                    }
                    else {
                        var kalantutuar = parseFloat(ToplamTutar) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#EkHizmetTutar").val(formattedOutput.format(parseFloat(toplamekhizmetfiyat)));
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar)));
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar, "TL", 2, ".", ",", "%v %s"));
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s"));
                    }
                }
                EkHizmetListesi.filter(":checked").each(function () {
                    secilenekhizmetID.push($(this).data("ekhizmetid"));
                    ekhizmetfiyat = $(this).data("fiyat").replace("TL", "");
                    ekhizmetfiyat = ekhizmetfiyat.replace(".", "");
                    ekhizmetfiyat = ekhizmetfiyat.replace(",", ".");
                    toplamekhizmetfiyat = toplamekhizmetfiyat + parseFloat(ekhizmetfiyat);
                    $("#EkHizmetTutar").val(formattedOutput.format(parseFloat(toplamekhizmetfiyat)));
                    $("#slimtest4").append("<div class='alert alert-secondary mb-2'>" +
                        "<h5 class='card-title'>" + $(this).val() + "<span class='fw-700'> - " + accounting.formatMoney(ekhizmetfiyat, "TL", 2, ".", ",", "%v %s") + "</span></h5>" + $(this).data("ekhizmetdetay") +
                        "</div>");
                    ToplamTutar = parseFloat(toplampaketfiyat) + parseFloat(toplamekhizmetfiyat);

                    iskonto = $("#Iskonto").val().replace(" TL", "");
                    iskonto = iskonto.replace(".", "");
                    iskonto = iskonto.replace(",", ".");

                    if (iskonto != "") {
                        var ToplamTutar2 = parseFloat(ToplamTutar) - parseFloat(iskonto);
                        var kalantutuar = parseFloat(ToplamTutar2) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar2)));  // paketler sayfası alt toplam 16.000
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası üst sözleşme turatı
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s")); //ödemeler sayfası öedene ve ödenecek tutardan hesaplanacak (sozlesmetutari - (Odemetoplam+kalanodemetoplam))
                    }
                    else {
                        var kalantutuar = parseFloat(ToplamTutar) - (parseFloat(alacaktoplam) + parseFloat(odemetoplam));
                        $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar)));
                        $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar, "TL", 2, ".", ",", "%v %s"));
                        $("#sozlesmekalan").html(accounting.formatMoney(kalantutuar, "TL", 2, ".", ",", "%v %s"));
                    }
                });
            }
            // ------ Ek Hizmetler Listesindeki hizmet seçimi
            // ------ Süreçler Listesindeki süreç seçimi
            var SurecListesi = $("#Surecler :checkbox");
            SurecListesi.on("change", function () {
                SecilenSurecler();
            });
            function SecilenSurecler() {
                secilensurecID = [];
                SurecListesi.filter(":checked").each(function () {
                    secilensurecID.push($(this).data("surecid"));
                });
            }
            // ------ Süreçler Listesindeki süreç seçimi

            $(".tutarlar").on('change', function () {
                iskonto = $("#Iskonto").val().replace(" TL", "");
                iskonto = iskonto.replace(".", "");
                iskonto = iskonto.replace(",", ".");
                var ToplamTutar2 = parseFloat(ToplamTutar) - parseFloat(iskonto);
                $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar2)));
                $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
                $("#sozlesmekalan").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
                $("#kalanalacak").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
            });

            $("#Iskonto").keypress(function () {
                iskonto = $("#Iskonto").val().replace(" TL", "");
                iskonto = iskonto.replace(".", "");
                iskonto = iskonto.replace(",", ".");
                var ToplamTutar2 = parseFloat(ToplamTutar) - parseFloat(iskonto);
                $("#ToplamTutar").val(formattedOutput.format(parseFloat(ToplamTutar2)));
                $("#sozlesmetutari").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
                $("#sozlesmekalan").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
                $("#kalanalacak").html(accounting.formatMoney(ToplamTutar2, "TL", 2, ".", ",", "%v %s"));
            });
            // ------  Paket ve EkHizmetler Sekmesi hesaplama ve yazma işlemleri  ------ //
            // ------ Alınan ve Gelecek Ödeme Ekleme/Silme İşlemleri
            $("#AlacakEkle").click(function () {
                var alacakgirilentutar = $("#KalanOdemeTutar").val(); // Eklenecek borç textboxtan okunuyor.
                alacakgirilentutar = alacakgirilentutar.replace(" TL", "");
                alacakgirilentutar = alacakgirilentutar.replace(".", "");
                alacakgirilentutar = alacakgirilentutar.replace(",", ".");

                var kalanalacaktutar = $("#sozlesmekalan").html(); // Kalan borç ilgili alandan okunuyor.
                kalanalacaktutar = kalanalacaktutar.replace("TL", "");
                kalanalacaktutar = kalanalacaktutar.replace(".", "");
                kalanalacaktutar = kalanalacaktutar.replace(",", ".");

                if (parseFloat(alacakgirilentutar) <= parseFloat(kalanalacaktutar)) { // Borç olarak girilen değer kalan borç miktarından küçük olmalıdır. değilse uyarı ver.
                    if ($("#KalanOdemeTutar").val() == "0" || $("#KalanOdemeTutar").val() == "") { // validation kontrol
                        $("#KalanOdemeTutar").focus();
                        $("#KalanTutarHata").append("<div class='kalanodemetutarhata' style='color:red'>Tutar 0(sıfır) olamaz.</div>");
                    }
                    else {
                        var kalanodeme = $("#KalanOdemeTutar").val().replace(" TL", "");
                        var AlacakData = new FormData();
                        AlacakData.append("SozlesmeId", sozlesmeId);
                        AlacakData.append("SozlesmeNo", sozlesmeNo);
                        AlacakData.append("MusteriId", musteriid);
                        AlacakData.append("KalanOdemeTarihi", $("#KalanOdemeTarihi").val());
                        AlacakData.append("KalanOdemeTutar", kalanodeme);
                        AlacakData.append("KalanOdemeAciklama", $("#KalanOdemeAciklama").val());
                        $.ajax({
                            type: "POST",
                            datatype: 'json',
                            data: AlacakData,
                            contentType: false,
                            processData: false,
                            url: "/Otomasyon/RezervasyonIslemleri/AlacakEkle/",
                            success: function (data) {
                                if (data.Sonuc == false) {
                                    alertify.set('notifier', 'delay', 5);
                                    alertify.set('notifier', 'position', 'top-center');
                                    alertify.error(data.Mesaj);
                                }
                                else if (data.Sonuc == true) {
                                    alertify.set('notifier', 'delay', 3);
                                    alertify.set('notifier', 'position', 'top-center');
                                    alertify.success(data.Mesaj);
                                    alacaktoplam = 0; // global değişken sıfırlanıyor.
                                    var alacaktutar = 0;
                                    $("#gelecekodemeler-satir").empty();
                                    $.each(data.data, function (index, item_1) {
                                        alacaktutar = item_1.Tutar;
                                        alacaktoplam = alacaktoplam + parseFloat(alacaktutar);
                                        if (item_1.OdemeAl == true) {
                                            $("#gelecekodemeler-satir").append("<tr class='bg-primary-50' id='gelecekodemeid-" + item_1.Id + "'>" +
                                                "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                "<td class='text-center'>" +
                                                "</td>" +
                                                "</tr>");
                                        }
                                        else {
                                            $("#gelecekodemeler-satir").append("<tr id='gelecekodemeid-" + item_1.Id + "'>" +
                                                "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                "<td class='text-center'>" +
                                                "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 alacaksmsgonder' data-alacakid='" + item_1.Id + "' data-alacaktarih='" + item_1.Tarih + "' data-alacaktutar='" + ParaFormat(item_1.Tutar) + "' title='SMS Gönder'>" +
                                                "<i class='fal fa-mobile-alt'></i>" +
                                                "</a>" +
                                                "<a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemeal' data-alacakid='" + item_1.Id + "' data-alacaktarih='" + item_1.Tarih + "' data-alacaktutar='" + ParaFormat(item_1.Tutar) + "' title='Ödeme Al'>" +
                                                "<i class='fal fa-plus-octagon'></i>" +
                                                "</a>" +
                                                "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 alacaksil' data-alacakid='" + item_1.Id + "' data-alacaktarih='" + item_1.Tarih + "' data-alacaktutar='" + ParaFormat(item_1.Tutar) + "' title='Borcu Sil'>" +
                                                "<i class='fal fa-trash-alt'></i>" +
                                                "</a>" +
                                                "</td>" +
                                                "</tr>");
                                        }
                                    });
                                    kalanalacaktutar = parseFloat(kalanalacaktutar) - parseFloat(alacakgirilentutar); // Kalan alacak miktarı ilgili alandan okunmuştu. bu miktardan toplam alacak tutarı düşülerek ilgili alana yeniden yazılıyor.
                                    $("#sozlesmekalan").html(accounting.formatMoney(kalanalacaktutar, "TL", 2, ".", ",", "%v %s"));
                                    $("#kalanodemetoplam2").html(accounting.formatMoney(alacaktoplam, "TL", 2, ".", ",", "%v %s"));
                                    $("#kalanodemetoplam").html(accounting.formatMoney(alacaktoplam, "TL", 2, ".", ",", "%v %s"));
                                    $("#KalanOdemeTarihi").val(dateFormat(new Date()));
                                    $("#KalanOdemeTutar").val("");
                                    $("#KalanOdemeAciklama").val("");
                                }
                            },
                            error: function (err) {
                                alert("HATA");
                            }
                        });
                    }
                }
                else {
                    Swal.fire(
                        {
                            title: "Borç Uyarı",
                            html: "<p style='color:red'> Sözleşme Tutarından veya Kalan Tutardan fazla bir borç ekleyemezsiniz!</p>",
                            type: "warning",
                            confirmButtonText: "Tamam"
                        });
                }
            });
            $("#tb-gelecekodemeler").on('click', '.alacaksil', function () {
                var id = $(this).data("alacakid");
                var tarih = $(this).data("alacaktarih");
                var tutar = $(this).data("alacaktutar");

                var kalan = $("#sozlesmekalan").html(); // Ödemeler tarafında Son kalan tutar
                kalan = kalan.replace("TL", "");
                kalan = kalan.replace(".", "");
                kalan = kalan.replace(",", ".");

                var kalanodemelertoplam = $("#kalanodemetoplam2").html(); // Kalan borç ilgili alandan okunuyor.
                kalanodemelertoplam = kalanodemelertoplam.replace("TL", "");
                kalanodemelertoplam = kalanodemelertoplam.replace(".", "");
                kalanodemelertoplam = kalanodemelertoplam.replace(",", ".");

                var silinentutar = tutar.replace(" TL", "");
                silinentutar = silinentutar.replace(".", "");
                silinentutar = silinentutar.replace(",", ".");

                Swal.fire(
                    {
                        title: "Kalan Ödeme Sil",
                        html: "<p style='color:red;font-weight:bold;font-size:12pt;'>&laquo; " + tarih + " - " + tutar + " &raquo;</p> <p style='color:red;font-size:12pt;'><h3> Kalan Ödeme silinsin mi?</h3></p> ",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonText: "Sil!",
                        cancelButtonText: "İptal"
                    }).then(function (result) {
                        if (result.value) {
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/AlacakSil/" + id,
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        var alacaktoplam = 0;
                                        var alacaktutar = 0;
                                        $("#gelecekodemeler-satir").empty();
                                        $.each(data.data, function (index, item_1) {
                                            alacaktutar = item_1.Tutar;
                                            alacaktoplam = alacaktoplam + parseFloat(alacaktutar);
                                            if (item_1.OdemeAl == true) {
                                                $("#gelecekodemeler-satir").append("<tr class='bg-primary-50' id='gelecekodemeid-" + item_1.Id + "'>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                $("#gelecekodemeler-satir").append("<tr id='gelecekodemeid-" + item_1.Id + "'>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 alacaksmsgonder' data-alacakid='" + item_1.Id + "' data-alacaktarih='" + item_1.Tarih + "' data-alacaktutar='" + ParaFormat(item_1.Tutar) + "' title='SMS Gönder'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemeal' data-toggle='modal' data-target='#OdemeAlModal' data-alacakid='" + item_1.Id + "' data-alacaktarih='" + item_1.Tarih + "' data-alacaktutar='" + ParaFormat(item_1.Tutar) + "' title='Ödeme Al'>" +
                                                    "<i class='fal fa-plus-octagon'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 alacaksil' data-alacakid='" + item_1.Id + "' data-alacaktarih='" + item_1.Tarih + "' data-alacaktutar='" + ParaFormat(item_1.Tutar) + "' title='Borcu Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                        });
                                        var kalanbakiye = parseFloat(kalan) + parseFloat(silinentutar);
                                        $("#kalanodemetoplam2").html(accounting.formatMoney(alacaktoplam, "TL", 2, ".", ",", "%v %s"));
                                        $("#kalanodemetoplam").html(accounting.formatMoney(alacaktoplam, "TL", 2, ".", ",", "%v %s"));
                                        $("#sozlesmekalan").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s"));
                                        $("#KalanOdemeTarihi").val(dateFormat(new Date()));
                                        $("#KalanOdemeTutar").val("");
                                        $("#KalanOdemeAciklama").val("");
                                    }
                                },
                                error: function (err) {
                                    alert("HATA");
                                }
                            });
                        }
                    });
            }); // Kalan Ödeme Sil
            $("#tb-gelecekodemeler").on('click', '.odemeal', function () {
                var id = $(this).data("alacakid");
                var tarih = $(this).data("alacaktarih");
                var tutar = $(this).data("alacaktutar");
                $("#OdemeTarihi").data("alacakid", id);
                $("#OdemeTarihi").data("alacaktutar", tutar);
                $("#OdemeTarihi").val($(this).data("alacaktarih"));
                $("#OdemeTutar").val($(this).data("alacaktutar"));
                //$("#OdemeSekli").focus();
                OdemeAlDurum = true;
            }); // BorcuÖdemeye dönüştür
            $("#tb-gelecekodemeler").on('click', '.alacaksmsgonder', function () {
                var id = $(this).data("alacakid");
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    //data: SMSGonderData,
                    contentType: false,
                    processData: false,
                    url: "/Otomasyon/RezervasyonIslemleri/AlacakOdemeSMSAyarKotrol/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            Swal.fire(
                                {
                                    title: "Bilgi SMS'i Gönder",
                                    //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                                    html: "<p style='color:red;font-size:12pt;'><h3> " + data.Mesaj + " </h3></p> ",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonText: "Tamam!"
                                })
                        }
                        else if (data.Sonuc == true) {
                            Swal.fire(
                                {
                                    title: "Bilgi SMS'i Gönder",
                                    //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                                    html: "<p style='color:red;font-size:12pt;'><h3> Müşteriye Borç Bilgi SMS'i gönderilsin mi?</h3></p> ",
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonText: "Gönder!"
                                }).then(function (result) {
                                    if (result.value) {

                                        var SMSGonderData = new FormData();
                                        SMSGonderData.append("MusteriId", musteriid);
                                        SMSGonderData.append("SozlesmeId", sozlesmeId);
                                        SMSGonderData.append("AlacakId", id);
                                        $.ajax({
                                            type: "POST",
                                            datatype: 'json',
                                            data: SMSGonderData,
                                            contentType: false,
                                            processData: false,
                                            beforeSend: function () {
                                                Swal.fire(
                                                    {
                                                        title: "Müşteriye Bilgi SMS'i Gönderiliyor!",
                                                        html: "<strong>Lütfen Bekleyin.</strong>",
                                                        onBeforeOpen: function onBeforeOpen() {
                                                            Swal.showLoading();
                                                        }
                                                    });
                                            },
                                            url: "/Otomasyon/RezervasyonIslemleri/AlacakOdemeSMSGonder/",
                                            success: function (data) {
                                                if (data.Sonuc == false) {
                                                    alertify.set('notifier', 'delay', 5);
                                                    alertify.set('notifier', 'position', 'top-center');
                                                    alertify.error(data.Mesaj);
                                                    swal.close();
                                                }
                                                else if (data.Sonuc == true) {
                                                    alertify.set('notifier', 'delay', 3);
                                                    alertify.set('notifier', 'position', 'top-center');
                                                    alertify.success(data.Mesaj);
                                                    swal.close();
                                                }
                                            },
                                            error: function (err) {
                                                alert("HATA");
                                            }
                                        });
                                    }
                                });
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            }); // Alacak Ödeme Bilgi SMS i gönder

            $("#OdemeAl").click(function () {
                var OdemeAlId = $("#OdemeTarihi").data("alacakid");

                var odemetutar = $("#OdemeTutar").val();
                odemetutar = odemetutar.replace(" TL", "");
                odemetutar = odemetutar.replace(".", "");
                odemetutar = odemetutar.replace(",", ".");

                var kalanbakiye = $("#sozlesmekalan").html();
                kalanbakiye = kalanbakiye.replace(" TL", "");
                kalanbakiye = kalanbakiye.replace(".", "");
                kalanbakiye = kalanbakiye.replace(",", ".");

                var SozlesmeTutar = $("#sozlesmetutari").html();
                SozlesmeTutar = SozlesmeTutar.replace(" TL", "");
                SozlesmeTutar = SozlesmeTutar.replace(".", "");
                SozlesmeTutar = SozlesmeTutar.replace(",", ".");

                var SozlesmeKalan = $("#sozlesmekalan").html();
                SozlesmeKalan = SozlesmeKalan.replace(" TL", "");
                SozlesmeKalan = SozlesmeKalan.replace(".", "");
                SozlesmeKalan = SozlesmeKalan.replace(",", ".");

                var KalanOdemeToplam = $("#kalanodemetoplam").html();
                KalanOdemeToplam = KalanOdemeToplam.replace(" TL", "");
                KalanOdemeToplam = KalanOdemeToplam.replace(".", "");
                KalanOdemeToplam = KalanOdemeToplam.replace(",", ".");

                if (OdemeAlDurum == true) { // Eğer Borçtan ödeme alınıyorsa kalan bakiye kontrolü yapılmayacak
                    var girilentutar = $("#OdemeTutar").val().replace(" ", "");
                    girilentutar = girilentutar.replace("TL", "");
                    girilentutar = girilentutar.replace(".", "");
                    girilentutar = girilentutar.replace(",", ".");
                    var alacaktutar = $("#OdemeTarihi").data("alacaktutar").replace(" ", "");
                    alacaktutar = alacaktutar.replace("TL", "");
                    alacaktutar = alacaktutar.replace(".", "");
                    alacaktutar = alacaktutar.replace(",", ".");

                    if (parseFloat(alacaktutar) != parseFloat(girilentutar)) {
                        Swal.fire(
                            {
                                title: "Borç Uyarı",
                                html: "<p style='color:red'> Girilen Tutar ile Alacak Tutar aynı değil!</p>",
                                type: "warning",
                                confirmButtonText: "Tamam"
                            });
                    }
                    else {
                        if ($("#OdemeTutar").val() == "0" || $("#OdemeTutar").val() == "") {
                            $("#OdemeTutar").focus();
                            $("#OdemeTutarHata").append("<div class='odemetutarhata' style='color:red'>Tutar 0(sıfır) olamaz.</div>");
                        }
                        else {
                            var AlinanOdemeData = new FormData();
                            AlinanOdemeData.append("SozlesmeId", sozlesmeId);
                            AlinanOdemeData.append("SozlesmeNo", sozlesmeNo);
                            AlinanOdemeData.append("OdemeAdSoyad", $("#AdSoyad").val());
                            AlinanOdemeData.append("MusteriId", musteriid);
                            AlinanOdemeData.append("OdemeAlDurum", OdemeAlDurum);
                            AlinanOdemeData.append("OdemeAlacakId", $("#OdemeTarihi").data("alacakid"));
                            AlinanOdemeData.append("OdemeTarihi", $("#OdemeTarihi").val());
                            AlinanOdemeData.append("OdemeTutar", $("#OdemeTutar").val().replace(" TL", ""));
                            AlinanOdemeData.append("OdemeSekli", $("#OdemeSekli").find("option:selected").text());
                            AlinanOdemeData.append("OdemeAciklama", $("#OdemeAciklama").val());
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                data: AlinanOdemeData,
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/AlinanOdemeEkle/",
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        odemetoplam = 0;
                                        var odemetutar = 0;
                                        $("#alinanodemeler-satir").empty();

                                        $.each(data.data, function (index, item_1) {
                                            odemetutar = item_1.Tutar;
                                            if (item_1.Iptal == true) { // Ödeme İptal edilmiş ise
                                                $("#alinanodemeler-satir").append("<tr class='bg-danger-50'>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal='" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                odemetoplam = odemetoplam + parseFloat(odemetutar);
                                                $("#alinanodemeler-satir").append("<tr>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 makbuzyazdir' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Makbuz Yazdır'>" +
                                                    "<i class='fal fa-print'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemesmsgonder' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='SMS Gönder'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 odemeiptal' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Ödemeyi İptal Et'>" +
                                                    "<i class='fal fa-times-circle'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal='" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                        });
                                        var kalantoplam = parseFloat(KalanOdemeToplam) - parseFloat(alacaktutar);

                                        $("#Odemetoplam").html(accounting.formatMoney(odemetoplam, "TL", 2, ".", ",", "%v %s"));
                                        $("#kalanodemetoplam").html(accounting.formatMoney(kalantoplam, "TL", 2, ".", ",", "%v %s"));
                                        $("#kalanodemetoplam2").html(accounting.formatMoney(kalantoplam, "TL", 2, ".", ",", "%v %s"));

                                        $("#gelecekodemeid-" + OdemeAlId).addClass("bg-primary-50"); // Borç tarafında ödemesi alınan satırın rengini değiştiriyor.
                                        $("#gelecekodemeid-" + OdemeAlId).find('a').addClass("disabled");
                                        OdemeAlDurum = false; // Ödeme durumu sıfırlanıyor.

                                        $("#OdemeTarihi").val(dateFormat(new Date()));
                                        $("#OdemeTutar").val("");
                                        $("#OdemeAciklama").val("");
                                        $("#OdemeSekli").val("1");
                                    }
                                },
                                error: function (err) {

                                    alert("HATA");
                                }
                            });
                        }
                    }
                }
                else {  // Eğer Borçtan ödeme alınmıyor doğrudan girilen değerden ödeme alınıyorsa kalan bakiye kontrolü yapılacak
                    if (kalanbakiye == 0) {
                        Swal.fire(
                            {
                                title: "Borç Bitti",
                                html: "<p style='color:red'> Sözleşme tutarının tamamı ödendi!</p><p style='color:red'> Başka Ödeme Kalmadı!</p>",
                                type: "warning",
                                confirmButtonText: "Tamam"
                            });
                    }
                    else if (parseFloat(odemetutar) > parseFloat(kalanbakiye)) {
                        Swal.fire(
                            {
                                title: "Geçersiz Tutar",
                                html: "<p style='color:red'> Girdiğiniz tutar Sözleşme Kalan tutarından büyük olamaz!</p>",
                                type: "warning",
                                confirmButtonText: "Tamam"
                            });
                    }
                    else {
                        if ($("#OdemeTutar").val() == "0" || $("#OdemeTutar").val() == "") {
                            $("#OdemeTutar").focus();
                            $("#OdemeTutarHata").append("<div class='odemetutarhata' style='color:red'>Tutar 0(sıfır) olamaz.</div>");
                        }
                        else {
                            var AlinanOdemeData = new FormData();
                            AlinanOdemeData.append("SozlesmeId", sozlesmeId);
                            AlinanOdemeData.append("SozlesmeNo", sozlesmeNo);
                            AlinanOdemeData.append("OdemeAdSoyad", $("#AdSoyad").val());
                            AlinanOdemeData.append("MusteriId", musteriid);
                            AlinanOdemeData.append("OdemeAlDurum", OdemeAlDurum);
                            AlinanOdemeData.append("OdemeAlacakId", $("#OdemeTarihi").data("alacakid"));
                            AlinanOdemeData.append("OdemeTarihi", $("#OdemeTarihi").val());
                            AlinanOdemeData.append("OdemeTutar", $("#OdemeTutar").val().replace(" TL", ""));
                            AlinanOdemeData.append("OdemeSekli", $("#OdemeSekli").find("option:selected").text());
                            AlinanOdemeData.append("OdemeAciklama", $("#OdemeAciklama").val());
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                data: AlinanOdemeData,
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/AlinanOdemeEkle/",
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        odemetoplam = 0;
                                        var odemetutar = 0;
                                        $("#alinanodemeler-satir").empty();
                                        $.each(data.data, function (index, item_1) {
                                            odemetutar = item_1.Tutar;
                                            if (item_1.Iptal == true) { // Ödeme İptal edilmiş ise
                                                $("#alinanodemeler-satir").append("<tr class='bg-danger-50'>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal='" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                odemetoplam = odemetoplam + parseFloat(odemetutar);
                                                $("#alinanodemeler-satir").append("<tr>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 makbuzyazdir' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Makbuz Yazdır'>" +
                                                    "<i class='fal fa-print'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemesmsgonder' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='SMS Gönder'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 odemeiptal' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Ödemeyi İptal Et'>" +
                                                    "<i class='fal fa-times-circle'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal='" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                        });

                                        var odemetutar = $("#OdemeTutar").val();
                                        odemetutar = odemetutar.replace(" TL", "");
                                        odemetutar = odemetutar.replace(".", "");
                                        odemetutar = odemetutar.replace(",", ".");

                                        var kalanbakiye = parseFloat(SozlesmeKalan) - parseFloat(odemetutar);

                                        $("#Odemetoplam").html(accounting.formatMoney(odemetoplam, "TL", 2, ".", ",", "%v %s"));
                                        $("#sozlesmekalan").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s"));

                                        // Kalan ödeme tarafında
                                        if (OdemeAlDurum == false) {
                                            if (parseFloat(alacaktoplam) == 0) { // alacak girilmişse alacaktoplam değişkeni sıfır olacak
                                                $("#kalanalacak").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s")); // kalan alacak alanına yapılan ödemeler sonucunda kalan bakiye yazılacak.
                                            }
                                            else // eger bir alacak kaydı girildiyse alacaktoplam değeri yapılan ödemeler sonucunda kalan bakiyeden alacak toplam değeri çıkılarak kalan bakiye yazılacak.
                                            {
                                                var alacakkalan = parseFloat(kalanbakiye) - parseFloat(alacaktoplam);
                                                if (alacakkalan >= 0) {
                                                    $("#kalanalacak").html(accounting.formatMoney(alacakkalan, "TL", 2, ".", ",", "%v %s"));
                                                }
                                            }
                                        }
                                        else {
                                            $("#gelecekodemeid-" + OdemeAlId).addClass("bg-primary-50"); // Borç tarafında ödemesi alınan satırın rengini değiştiriyor.
                                            $("#gelecekodemeid-" + OdemeAlId).find('a').addClass("disabled");
                                            OdemeAlDurum == false; // Ödeme durumu sıfırlanıyor.
                                        }
                                        $("#OdemeTarihi").val(dateFormat(new Date()));
                                        $("#OdemeTutar").val("");
                                        $("#OdemeAciklama").val("");
                                        $("#OdemeSekli").val("1");
                                    }
                                },
                                error: function (err) {
                                    alert("HATA");
                                }
                            });
                        }
                    }
                }
            });
            $("#tb-alinanodemeler").on('click', '.odemeiptal', function () {
                var id = $(this).data("odemeid");
                var odemelergelecekid = $(this).data("odemelergelecekid");
                var tarih = $(this).data("odemetarih");
                var tutar = $(this).data("odemetutar");
                Swal.fire(
                    {
                        title: "Ödeme İptal",
                        html: "<p style='color:red;font-weight:bold;font-size:12pt;'>&laquo; " + tarih + " - " + tutar + " &raquo;</p> <p style='color:red;font-size:12pt;'><h3> Ödeme iptal edilsin mi?</h3></p> ",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonText: "Evet, İptal Et!",
                        cancelButtonText: "Vazgeç"
                    }).then(function (result) {
                        if (result.value) {
                            var AlinanOdemeData = new FormData();
                            AlinanOdemeData.append("Id", id);
                            AlinanOdemeData.append("OdemelerGelecekId", odemelergelecekid);
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                data: AlinanOdemeData,
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/AlinanOdemeIptal/" + id,
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        var odemetoplam = $("#Odemetoplam").html(); // yapılmış ödemeler toplamının yazıldığı alandan bu değeri okuyorum.
                                        odemetoplam = odemetoplam.replace(" TL", "");
                                        odemetoplam = odemetoplam.replace(".", "");
                                        odemetoplam = odemetoplam.replace(",", ".");
                                        var iptaltutar = 0; // iptal edilen tutar
                                        iptaltutar = tutar.replace(" TL", "");
                                        iptaltutar = iptaltutar.replace(".", "");
                                        iptaltutar = iptaltutar.replace(",", ".");
                                        $("#alinanodemeler-satir").empty();
                                        odemetoplam = odemetoplam - parseFloat(iptaltutar); // toplam ödeme tutarından iptal edilen tutardüşülüyor.
                                        $.each(data.data, function (index, item_1) {
                                            if (item_1.Iptal == true) {
                                                $("#alinanodemeler-satir").append("<tr class='bg-danger-50'>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal'" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                $("#alinanodemeler-satir").append("<tr>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 makbuzyazdir' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "'title='Makbuz Yazdır'>" +
                                                    "<i class='fal fa-print'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemesmsgonder' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='SMS Gönder'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 odemeiptal' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Ödemeyi İptal Et'>" +
                                                    "<i class='fal fa-times-circle'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal'" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                        });

                                        var sozlesmekalan = $("#sozlesmekalan").html();
                                        sozlesmekalan = sozlesmekalan.replace(" TL", "");
                                        sozlesmekalan = sozlesmekalan.replace(".", "");
                                        sozlesmekalan = sozlesmekalan.replace(",", ".");

                                        var kalanbakiye = parseFloat(ToplamTutar) - parseFloat(odemetoplam); // İptal sonucu kalan bakiye gündelleniyor.
                                        $("#Odemetoplam").html(accounting.formatMoney(odemetoplam, "TL", 2, ".", ",", "%v %s"));
                                        $("#sozlesmekalan").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s"));

                                        if (odemelergelecekid != 0) {
                                            $("#gelecekodemeid-" + odemelergelecekid).removeClass("bg-primary-50"); //Alınan ödeme iptal edildiğinde Borç tarafında ödemesi alınan satır eski haline getiriliyor.
                                            $("#gelecekodemeid-" + odemelergelecekid).find('a').removeClass("disabled");

                                            kalanbakiye = parseFloat(sozlesmekalan); // İptal sonucu kalan bakiye gündelleniyor.
                                            $("#sozlesmekalan").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s"));

                                            var KalanOdemeToplam = $("#kalanodemetoplam").html();
                                            KalanOdemeToplam = KalanOdemeToplam.replace(" TL", "");
                                            KalanOdemeToplam = KalanOdemeToplam.replace(".", "");
                                            KalanOdemeToplam = KalanOdemeToplam.replace(",", ".");

                                            var kalanodemelertoplam = parseFloat(KalanOdemeToplam) + parseFloat(iptaltutar)
                                            $("#kalanodemetoplam").html(accounting.formatMoney(kalanodemelertoplam, "TL", 2, ".", ",", "%v %s"));
                                            $("#kalanodemetoplam2").html(accounting.formatMoney(kalanodemelertoplam, "TL", 2, ".", ",", "%v %s"));
                                        }
                                        else {
                                            kalanbakiye = parseFloat(sozlesmekalan) + parseFloat(iptaltutar); // İptal sonucu kalan bakiye gündelleniyor.
                                            $("#sozlesmekalan").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s"));
                                        }
                                    }
                                },
                                error: function (err) {
                                    alert("HATA");
                                }
                            });
                        }
                    });
            }); // Alınan Ödeme İptal
            $("#tb-alinanodemeler").on('click', '.odemesil', function () {
                var id = $(this).data("odemeid");
                var tarih = $(this).data("odemetarih");
                var tutar = $(this).data("odemetutar");
                var iptal = $(this).data("iptal");
                $("#SilinenTutar").val($(this).data("odemetutar"));
                var odemelergelecekid = $(this).data("odemelergelecekid");
                Swal.fire(
                    {
                        title: "Ödeme Sil",
                        html: "<p style='color:red;font-weight:bold;font-size:12pt;'>&laquo; " + tarih + " - " + tutar + " &raquo;</p> <p style='color:red;font-size:12pt;'><h3> Ödeme silinsin mi?</h3></p> ",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonText: "Sil!"
                    }).then(function (result) {
                        if (result.value) {
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/AlinanOdemeSil/" + id,
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        var odemetoplam = 0;
                                        var odemetutar = 0;
                                        $("#alinanodemeler-satir").empty();
                                        $.each(data.data, function (index, item_1) {
                                            odemetutar = item_1.Tutar;
                                            if (item_1.Iptal == true) {
                                                $("#alinanodemeler-satir").append("<tr class='bg-danger-50'>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal'" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                odemetoplam = odemetoplam + parseFloat(odemetutar);
                                                $("#alinanodemeler-satir").append("<tr>" +
                                                    "<td class='text-center'>" + item_1.Tarih + "</td>" +
                                                    "<td class='text-right'>" + ParaFormat(item_1.Tutar) + "</td>" +
                                                    "<td class='text-center'>" + item_1.Aciklama + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 makbuzyazdir' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Makbuz Yazdır'>" +
                                                    "<i class='fal fa-print'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-success btn-icon mr-1 odemesmsgonder' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='SMS Gönder'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 odemeiptal' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' title='Ödemeyi İptal Et'>" +
                                                    "<i class='fal fa-times-circle'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 odemesil' data-odemelergelecekid='" + item_1.OdemelerGelecekId + "' data-odemeid='" + item_1.Id + "' data-odemetarih='" + item_1.Tarih + "' data-odemetutar='" + ParaFormat(item_1.Tutar) + "' data-iptal'" + item_1.Iptal + "' title='Ödemeyi Sil'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                        });
                                        if (iptal == true) { // Silinmek istenen iptal edilmiş satır ise bakiyelerde güncelleme olmayacak

                                        }
                                        else {
                                            $("#Odemetoplam").html(accounting.formatMoney(odemetoplam, "TL", 2, ".", ",", "%v %s"));

                                            var sozlesmekalan = $("#sozlesmekalan").html();
                                            sozlesmekalan = sozlesmekalan.replace(" TL", "");
                                            sozlesmekalan = sozlesmekalan.replace(".", "");
                                            sozlesmekalan = sozlesmekalan.replace(",", ".");

                                            var silinentutar = $("#SilinenTutar").val();
                                            silinentutar = silinentutar.replace(" TL", "");
                                            silinentutar = silinentutar.replace(".", "");
                                            silinentutar = silinentutar.replace(",", ".");

                                            if (parseFloat(odemelergelecekid) != 0) {
                                                $("#gelecekodemeid-" + odemelergelecekid).removeClass("bg-primary-50"); //Alınan ödeme silindiğinde Borç tarafında ödemesi alınan satır eski haline getiriliyor.
                                                $("#gelecekodemeid-" + odemelergelecekid).find('a').removeClass("disabled");

                                                kalanbakiye = parseFloat(sozlesmekalan); // İptal sonucu kalan bakiye gündelleniyor.
                                                $("#sozlesmekalan").html(accounting.formatMoney(kalanbakiye, "TL", 2, ".", ",", "%v %s"));

                                                var KalanOdemeToplam = $("#kalanodemetoplam").html();
                                                KalanOdemeToplam = KalanOdemeToplam.replace(" TL", "");
                                                KalanOdemeToplam = KalanOdemeToplam.replace(".", "");
                                                KalanOdemeToplam = KalanOdemeToplam.replace(",", ".");

                                                var kalanodemelertoplam = parseFloat(KalanOdemeToplam) + parseFloat(silinentutar)
                                                $("#kalanodemetoplam").html(accounting.formatMoney(kalanodemelertoplam, "TL", 2, ".", ",", "%v %s"));
                                                $("#kalanodemetoplam2").html(accounting.formatMoney(kalanodemelertoplam, "TL", 2, ".", ",", "%v %s"));
                                            }
                                            else {
                                                kalanbakiye = parseFloat(sozlesmekalan) + parseFloat(silinentutar); // İptal sonucu kalan bakiye gündelleniyor.
                                                $("#sozlesmekalan").html(accounting.formatMoney(parseFloat(kalanbakiye), "TL", 2, ".", ",", "%v %s")); // parseFloat(kalanbakiye) kullanmadan yanlış değer veriyor.
                                            }
                                        }
                                    }
                                },
                                error: function (err) {
                                    alert("HATA");
                                }
                            });
                        }
                    });
            }); // Alınan Ödeme Sil
            $("#tb-alinanodemeler").on('click', '.makbuzyazdir', function () {
                var id = $(this).data("odemeid");
                window.open("/Otomasyon/RezervasyonIslemleri/AlinanOdemeMakbuzYazdir/" + id, '_blank');
            }); // Ödeme Makbuzu Yazdır
            $("#tb-alinanodemeler").on('click', '.odemesmsgonder', function () {
                var id = $(this).data("odemeid");
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    //data: SMSGonderData,
                    contentType: false,
                    processData: false,
                    url: "/Otomasyon/RezervasyonIslemleri/AlinanOdemeSMSAyarKotrol/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            Swal.fire(
                                {
                                    title: "Bilgi SMS'i Gönder",
                                    //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                                    html: "<p style='color:red;font-size:12pt;'><h3> " + data.Mesaj + " </h3></p> ",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonText: "Tamam!"
                                })
                        }
                        else if (data.Sonuc == true) {
                            Swal.fire(
                                {
                                    title: "Bilgi SMS'i Gönder",
                                    //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                                    html: "<p style='color:red;font-size:12pt;'><h3> Müşteriye Ödeme bilgi SMS'i gönderilsin mi?</h3></p> ",
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonText: "Gönder!"
                                }).then(function (result) {
                                    if (result.value) {

                                        var SMSGonderData = new FormData();
                                        SMSGonderData.append("MusteriId", musteriid);
                                        SMSGonderData.append("SozlesmeId", sozlesmeId);
                                        SMSGonderData.append("OdemeId", id);
                                        $.ajax({
                                            type: "POST",
                                            datatype: 'json',
                                            data: SMSGonderData,
                                            contentType: false,
                                            processData: false,
                                            beforeSend: function () {
                                                Swal.fire(
                                                    {
                                                        title: "Müşteriye Bilgi SMS'i Gönderiliyor!",
                                                        html: "<strong>Lütfen Bekleyin.</strong>",
                                                        onBeforeOpen: function onBeforeOpen() {
                                                            Swal.showLoading();
                                                        }
                                                    });
                                            },
                                            url: "/Otomasyon/RezervasyonIslemleri/AlinanOdemeSMSGonder/",
                                            success: function (data) {
                                                if (data.Sonuc == false) {
                                                    alertify.set('notifier', 'delay', 5);
                                                    alertify.set('notifier', 'position', 'top-center');
                                                    alertify.error(data.Mesaj);
                                                    swal.close();
                                                }
                                                else if (data.Sonuc == true) {
                                                    alertify.set('notifier', 'delay', 3);
                                                    alertify.set('notifier', 'position', 'top-center');
                                                    alertify.success(data.Mesaj);
                                                    swal.close();
                                                }
                                            },
                                            error: function (err) {
                                                alert("HATA");
                                            }
                                        });
                                    }
                                });
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            }); // Çekim Randevusu Bilgi SMS i gönder
            // ------ Alınan ve Gelecek Ödeme Ekleme/Silme İşlemleri
            // ------ Çekim Randevusu Ekleme/Silme İşlemleri
            $("#CekimEkle").click(function () {
                if (($("#CekimBaslangic").val() == $("#CekimBitis").val())) {
                    $("#CekimBaslangic").focus();
                    $("#CekimZamanHata").append("<div class='hata' style='color:red'>Başlangıç ve Bitiş zamanları aynı olamaz.</div>");
                }
                else if (($("#CekimYeri").val() == "")) {
                    $("#CekimYeri").focus();
                    $("#CekimYeriHata").append("<div class='hata' style='color:red'>Çekim yapılacak yeri yazınız.</div>");
                }
                else if (RandevuPersonelIdArray.length == 0) {
                    $("#CekimPersonelIdHata").append("<div id='PersonelHata' style='color:red'>Lütfen bir personel seçiniz.</div>");
                }
                else {
                    var rezervasyontarih = $("#CekimTarihi").val();
                    var TatilKontrolData = new FormData();
                    TatilKontrolData.append("RezervasyonTarihi", $("#CekimTarihi").val());
                    $.ajax({
                        type: "POST",
                        datatype: 'json',
                        data: TatilKontrolData,
                        contentType: false,
                        processData: false,
                        url: "/Otomasyon/RezervasyonIslemleri/TatilKotrol/",
                        success: function (data) {
                            if (data.Sonuc == false) {
                                Swal.fire(
                                    {
                                        title: "Dikkat",
                                        html: "<p><h2 style='font-size:16px; color:red'><strong>Rezervasyon Tarihi : </strong>" + rezervasyontarih + "</h2></p><h4> " + data.Mesaj + "</h4>",
                                        type: "warning",
                                        confirmButtonText: "Tamam"
                                    });
                                //sonuctatilkontrolcekim = "çalışamaz";
                            }
                            else if (data.Sonuc == true) {
                                //sonuctatilkontrolcekim = "çalışabilir";
                                var PersonelData = new FormData();
                                PersonelData.append("RezervasyonTarihi", $("#CekimTarihi").val());
                                PersonelData.append("PersonelIdArray", RandevuPersonelIdArray);
                                $.ajax({
                                    type: "POST",
                                    datatype: 'json',
                                    data: PersonelData,
                                    contentType: false,
                                    processData: false,
                                    url: "/Otomasyon/RezervasyonIslemleri/PersonelIzinKontrol/",
                                    success: function (data) {
                                        if (data.Sonuc == false) {  //sonucizinkontrol = "çalışamaz";
                                            var personelAdi = "";
                                            $.each(data.CalisamazPersonel, function (index, pers) {
                                                personelAdi = personelAdi + pers.AdiSoyadi + "<br/>";
                                            });
                                            Swal.fire(
                                                {
                                                    title: "Dikkat",
                                                    html: "<p><h4 style='font-size:16px; color:red'> Aşağıdaki Personel(ler) rezervasyon tarihinde izinliler</h4></p> <p><h2> <strong> " + personelAdi + " </strong><h2> </p>",
                                                    type: "warning",
                                                    confirmButtonText: "Tamam"
                                                });
                                        }
                                        else if (data.Sonuc == true) {
                                            //sonucizinkontrolcekim = "çalışabilir";
                                            //var PersonelId = $("#CekimPersonelId").find("option:selected").val();
                                            var ZamanDilimiId = 0
                                            //var Personel = $("#CekimPersonelId").find("option:selected").text();
                                            var BaslangicSaati = $("#CekimBaslangic").val();
                                            var BitisSaati = $("#CekimBitis").val();
                                            var Tarih = $("#CekimTarihi").val();
                                            var GorevlendirmeKontrolData = new FormData();
                                            GorevlendirmeKontrolData.append("RezervasyonTarihi", Tarih);
                                            GorevlendirmeKontrolData.append("PersonelIdArray", RandevuPersonelIdArray);
                                            GorevlendirmeKontrolData.append("ZamanDilimiId", ZamanDilimiId);
                                            GorevlendirmeKontrolData.append("BaslangicSaati", BaslangicSaati);
                                            GorevlendirmeKontrolData.append("BitisSaati", BitisSaati);
                                            $.ajax({
                                                type: "POST",
                                                datatype: 'json',
                                                data: GorevlendirmeKontrolData,
                                                contentType: false,
                                                processData: false,
                                                url: "/Otomasyon/RezervasyonIslemleri/GorevlendirmeKontrol/",
                                                success: function (data) {
                                                    if (data.Sonuc == false) {
                                                        var personelAdi = "";
                                                        $.each(data.CalisamazPersonel, function (index, pers) {
                                                            personelAdi = personelAdi + pers.AdiSoyadi + "<br/>";
                                                        });
                                                        Swal.fire(
                                                            {
                                                                title: "Dikkat",
                                                                html: "<p><h4 style='font-size:16px; color:red'> Aşağıdaki Personel(ler) rezervasyon tarihinde başka bir randevu için görevlendirilmiş.</h4></p> <p><h2> <strong> " + personelAdi + " </strong><h2> </p>",
                                                                type: "warning",
                                                                confirmButtonText: "Tamam"
                                                            });
                                                    }
                                                    else if (data.Sonuc == true) {
                                                        //sonucgorevlendirmekontrolcekim = "çalışabilir";
                                                        var CekimData = new FormData();
                                                        CekimData.append("SozlesmeId", sozlesmeId);
                                                        CekimData.append("SozlesmeNo", sozlesmeNo);
                                                        CekimData.append("MusteriId", musteriid);
                                                        CekimData.append("PersonelIdArray", RandevuPersonelIdArray);
                                                        CekimData.append("CekimTarihi", $("#CekimTarihi").val());
                                                        CekimData.append("CekimBaslangic", $("#CekimBaslangic").val());
                                                        CekimData.append("CekimBitis", $("#CekimBitis").val());
                                                        CekimData.append("CekimYeri", $("#CekimYeri").val());
                                                        $.ajax({
                                                            type: "POST",
                                                            datatype: 'json',
                                                            data: CekimData,
                                                            contentType: false,
                                                            processData: false,
                                                            url: "/Otomasyon/RezervasyonIslemleri/CekimRandevuEkle/",
                                                            success: function (data) {
                                                                if (data.Sonuc == false) {
                                                                    alertify.set('notifier', 'delay', 5);
                                                                    alertify.set('notifier', 'position', 'top-center');
                                                                    alertify.error(data.Mesaj);
                                                                }
                                                                else if (data.Sonuc == true) {
                                                                    alertify.set('notifier', 'delay', 3);
                                                                    alertify.set('notifier', 'position', 'top-center');
                                                                    alertify.success(data.Mesaj);
                                                                    $("#cekimrandevu-satir").empty();
                                                                    var GorevliPersoneller = "";
                                                                    $.each(data.PersonelList, function (index, item_1) {
                                                                        GorevliPersoneller = GorevliPersoneller + item_1.PersonelAdiSoyadi + " - " + item_1.PersonelGorevi + "<br/>";
                                                                    });
                                                                    $.each(data.data, function (index, item_1) {
                                                                        var t = item_1.Tarih;
                                                                        var tarih = dateFormat(new Date(parseInt(t.match(/\d+/)[0])));
                                                                        var bs = item_1.Baslangic;
                                                                        var bt = item_1.Bitis;
                                                                        var bs1 = timeFormat(new Date(parseInt(bs.match(/\d+/)[0])));
                                                                        var bt1 = timeFormat(new Date(parseInt(bt.match(/\d+/)[0])));
                                                                        if (item_1.Iptal == true) {
                                                                            $("#cekimrandevu-satir").append("<tr class='bg-danger-50'>" +
                                                                                "<td>" + tarih + "</td>" +
                                                                                //"<td>" + baslangicsaat + ":" + baslangicdakika + " - " + bitissaat + ":" + bitisdakika + "</td>" +
                                                                                "<td>" + bs1 + " - " + bt1 + "</td>" +
                                                                                "<td>" + item_1.Aciklama + "</td>" +
                                                                                "<td>" + GorevliPersoneller + "</td>" +
                                                                                "<td class='text-center'>" +
                                                                                //"<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms' title='Bilgilendirme SMS'i Gönder' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                                                //    "<i class='fal fa-mobile-alt'></i>" +
                                                                                //"</a>" +
                                                                                //"<a href='#' class='btn btn-xs btn-info btn-icon mr-1 disabled cekimranduevuiptal' title='Randevuyu İptal Et' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                                                //   "<i class='fal fa-times-circle'></i>" +
                                                                                //"</a>" +
                                                                                "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil' title='Randevuyu Sil' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                                                "<i class='fal fa-trash-alt'></i>" +
                                                                                "</a>" +
                                                                                "</td>" +
                                                                                "</tr>");
                                                                        }
                                                                        else {
                                                                            $("#cekimrandevu-satir").append("<tr>" +
                                                                                "<td>" + tarih + "</td>" +
                                                                                //"<td>" + baslangicsaat + ":" + baslangicdakika + " - " + bitissaat + ":" + bitisdakika + "</td>" +
                                                                                "<td>" + bs1 + " - " + bt1 + "</td>" +
                                                                                "<td>" + item_1.Aciklama + "</td>" +
                                                                                "<td>" + GorevliPersoneller + "</td>" +
                                                                                "<td class='text-center'>" +
                                                                                "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms' title='Bilgilendirme SMS'i Gönder' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                                                "<i class='fal fa-mobile-alt'></i>" +
                                                                                "</a>" +
                                                                                "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 cekimranduevuiptal' title='Randevuyu İptal Et' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                                                "<i class='fal fa-times-circle'></i>" +
                                                                                "</a>" +
                                                                                "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil' title='Randevuyu Sil' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                                                "<i class='fal fa-trash-alt'></i>" +
                                                                                "</a>" +
                                                                                "</td>" +
                                                                                "</tr>");
                                                                        }
                                                                        //});
                                                                    });
                                                                }
                                                                $("#CekimTarihi").datepicker("setDate", new Date());
                                                                $("#CekimBaslangic").val("00:00");
                                                                $("#CekimBitis").val("00:00");
                                                                $("#CekimYeri").val("");
                                                                var RandevuPersonelListesi = $("#PersonelListesi :checkbox");
                                                                RandevuPersonelListesi.prop("checked", false);
                                                            },
                                                            error: function (err) {
                                                                alert("HATA");
                                                            }
                                                        });
                                                    }
                                                },
                                                error: function (err) {
                                                    alert("HATA");
                                                }
                                            });
                                        }
                                    },
                                    error: function (err) {
                                        alert("HATA");
                                    }
                                });
                            }
                        },
                        error: function (err) {
                            alert("HATA");
                        }
                    });
                }
            });
            $("#tb-cekimrandeulari").on('click', '.cekimranduevuiptal', function () {
                var id = $(this).data("cekimid");
                var tarih = $(this).data("cekimtarih");
                var baslangic = $(this).data("cekimbaslama");
                var bitis = $(this).data("cekimbitis");
                Swal.fire(
                    {
                        title: "Randevu İptal",
                        //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                        html: "<p style='color:red;font-weight:bold;font-size:12pt;'>&laquo; " + tarih + " - " + baslangic + "-" + bitis + " &raquo;</p> <p style='color:red;font-size:12pt;'><h3> Çekim Randevusunu iptal edilsin mi?</h3></p> ",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonText: "Evet, İptal Et!"
                    }).then(function (result) {
                        if (result.value) {
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/CekimRandevuIptal/" + id,
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        $("#cekimrandevu-satir").empty();
                                        $.each(data.data, function (index, item_1) {
                                            //$.each(item, function (index_1, item_1) {
                                            var t = item_1.Tarih;
                                            var tarih = dateFormat(new Date(parseInt(t.match(/\d+/)[0])));

                                            var bs = item_1.Baslangic;
                                            var bt = item_1.Bitis;
                                            var bs1 = timeFormat(new Date(parseInt(bs.match(/\d+/)[0])));
                                            var bt1 = timeFormat(new Date(parseInt(bt.match(/\d+/)[0])));

                                            //var baslangic = bs1;
                                            //var bitis = bt1;
                                            //var baslangicsaat = baslangic.split(":")[0];
                                            //var baslangicdakika = baslangic.split(":")[1];
                                            //if (baslangicsaat < 10)
                                            //{ baslangicsaat = "0" + baslangicsaat }
                                            //if (baslangicdakika < 10)
                                            //{ baslangicdakika = "0" + baslangicdakika }
                                            //var bitissaat = bitis.split(":")[0];
                                            //var bitisdakika = bitis.split(":")[1];
                                            //if (bitissaat < 10)
                                            //{ bitissaat = "0" + bitissaat }
                                            //if (bitisdakika < 10)
                                            //{ bitisdakika = "0" + bitisdakika }

                                            if (item_1.Iptal == true) {
                                                $("#cekimrandevu-satir").append("<tr class='bg-danger-50'>" +
                                                    "<td>" + tarih + "</td>" +
                                                    //"<td>" + baslangicsaat + ":" + baslangicdakika + " - " + bitissaat + ":" + bitisdakika + "</td>" +
                                                    "<td>" + bs1 + " - " + bt1 + "</td>" +
                                                    "<td>" + item_1.Aciklama + "</td>" +
                                                    "<td>" + item_1.Personel + "</td>" +
                                                    "<td class='text-center'>" +
                                                    //"<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms' title='Bilgilendirme SMS'i Gönder' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    //    "<i class='fal fa-mobile-alt'></i>" +
                                                    //"</a>" +
                                                    //"<a href='#' class='btn btn-xs btn-info btn-icon mr-1 disabled cekimranduevuiptal' title='Randevuyu İptal Et' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    //   "<i class='fal fa-times-circle'></i>" +
                                                    //"</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil' title='Randevuyu Sil' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                $("#cekimrandevu-satir").append("<tr>" +
                                                    "<td>" + tarih + "</td>" +
                                                    //"<td>" + baslangicsaat + ":" + baslangicdakika + " - " + bitissaat + ":" + bitisdakika + "</td>" +
                                                    "<td>" + bs1 + " - " + bt1 + "</td>" +
                                                    "<td>" + item_1.Aciklama + "</td>" +
                                                    "<td>" + item_1.Personel + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms' title='Bilgilendirme SMS'i Gönder' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 cekimranduevuiptal' title='Randevuyu İptal Et' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-times-circle'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil' title='Randevuyu Sil' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            //});
                                        });
                                    }
                                },
                                error: function (err) {
                                    $("#YeniRezervasyonEkleModal").modal("hide");
                                    alert("HATA");
                                }
                            });
                        }
                    });
            }); // Çekim Randevusu İptal
            $("#tb-cekimrandeulari").on('click', '.cekimranduevusil', function () {
                var id = $(this).data("cekimid");
                var tarih = $(this).data("cekimtarih");
                var baslangic = $(this).data("cekimbaslama");
                var bitis = $(this).data("cekimbitis");
                Swal.fire(
                    {
                        title: "Randevu İptal",
                        //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                        html: "<p style='color:red;font-weight:bold;font-size:12pt;'>&laquo; " + tarih + " - " + baslangic + "-" + bitis + " &raquo;</p> <p style='color:red;font-size:12pt;'><h3> Çekim Randevusunu Silinsin mi?</h3></p> ",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonText: "Sil!"
                    }).then(function (result) {
                        if (result.value) {
                            $.ajax({
                                type: "POST",
                                datatype: 'json',
                                contentType: false,
                                processData: false,
                                url: "/Otomasyon/RezervasyonIslemleri/CekimRandevuSil/" + id,
                                success: function (data) {
                                    if (data.Sonuc == false) {
                                        alertify.set('notifier', 'delay', 5);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.error(data.Mesaj);
                                    }
                                    else if (data.Sonuc == true) {
                                        alertify.set('notifier', 'delay', 3);
                                        alertify.set('notifier', 'position', 'top-center');
                                        alertify.success(data.Mesaj);
                                        $("#cekimrandevu-satir").empty();
                                        $.each(data.data, function (index, item_1) {
                                            //$.each(item, function (index_1, item_1) {
                                            if (item_1.Iptal == true) {
                                                var t = item_1.Tarih;
                                                var tarih = dateFormat(new Date(parseInt(t.match(/\d+/)[0])));

                                                var bs = item_1.Baslangic;
                                                var bt = item_1.Bitis;
                                                var bs1 = timeFormat(new Date(parseInt(bs.match(/\d+/)[0])));
                                                var bt1 = timeFormat(new Date(parseInt(bt.match(/\d+/)[0])));



                                                $("#cekimrandevu-satir").append("<tr class='bg-danger-50'>" +
                                                    "<td>" + tarih + "</td>" +
                                                    //"<td>" + baslangicsaat + ":" + baslangicdakika + " - " + bitissaat + ":" + bitisdakika + "</td>" +
                                                    "<td>" + bs1 + " - " + bt1 + "</td>" +
                                                    "<td>" + item_1.Aciklama + "</td>" +
                                                    "<td>" + item_1.Personel + "</td>" +
                                                    "<td class='text-center'>" +
                                                    //"<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms' title='Bilgilendirme SMS'i Gönder' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    //    "<i class='fal fa-mobile-alt'></i>" +
                                                    //"</a>" +
                                                    //"<a href='#' class='btn btn-xs btn-info btn-icon mr-1 disabled cekimranduevuiptal' title='Randevuyu İptal Et' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    //   "<i class='fal fa-times-circle'></i>" +
                                                    //"</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil' title='Randevuyu Sil' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            else {
                                                $("#cekimrandevu-satir").append("<tr>" +
                                                    "<td>" + tarih + "</td>" +
                                                    //"<td>" + baslangicsaat + ":" + baslangicdakika + " - " + bitissaat + ":" + bitisdakika + "</td>" +
                                                    "<td>" + bs1 + " - " + bt1 + "</td>" +
                                                    "<td>" + item_1.Aciklama + "</td>" +
                                                    "<td>" + item_1.Personel + "</td>" +
                                                    "<td class='text-center'>" +
                                                    "<a href='#' class='btn btn-xs btn-primary btn-icon mr-1 cekimranduevusms' title='Bilgilendirme SMS'i Gönder' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-mobile-alt'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-info btn-icon mr-1 cekimranduevuiptal' title='Randevuyu İptal Et' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-times-circle'></i>" +
                                                    "</a>" +
                                                    "<a href='#' class='btn btn-xs btn-danger btn-icon mr-1 cekimranduevusil' title='Randevuyu Sil' data-cekimid='" + item_1.Id + "' data-cekimtarih='" + item_1.Tarih + "' data-cekimbaslama='" + item_1.Baslangic + "' data-cekimbitis='" + item_1.Bitis + "'>" +
                                                    "<i class='fal fa-trash-alt'></i>" +
                                                    "</a>" +
                                                    "</td>" +
                                                    "</tr>");
                                            }
                                            //});
                                        });
                                    }
                                },
                                error: function (err) {
                                    $("#YeniRezervasyonEkleModal").modal("hide");
                                    alert("HATA");
                                }
                            });
                        }
                    });
            }); // Çekim Randevusu Sil
            $("#tb-cekimrandeulari").on('click', '.cekimranduevusms', function () {
                var id = $(this).data("cekimid");
                var PersonelId = $("#PersonelId").find("option:selected").val();
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    //data: SMSGonderData,
                    contentType: false,
                    processData: false,
                    url: "/Otomasyon/RezervasyonIslemleri/CekimRandevuSMSAyarKotrol/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            Swal.fire(
                                {
                                    title: "Bilgi SMS'i Gönder",
                                    //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                                    html: "<p style='color:red;font-size:12pt;'><h3> " + data.Mesaj + " </h3></p> ",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonText: "Tamam!"
                                })
                        }
                        else if (data.Sonuc == true) {
                            Swal.fire(
                                {
                                    title: "Bilgi SMS'i Gönder",
                                    //text: "< " + giskategori + " > adlı Günlük İş Katergorisi silinsin mi?",
                                    html: "<p style='color:red;font-size:12pt;'><h3> Müşteriye randevu bilgi SMS'i gönderilsin mi?</h3></p> ",
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonText: "Gönder!"
                                }).then(function (result) {
                                    if (result.value) {
                                        var SMSGonderData = new FormData();
                                        SMSGonderData.append("MusteriId", musteriid);
                                        SMSGonderData.append("SozlesmeId", sozlesmeId);
                                        SMSGonderData.append("SozlesmeNo", sozlesmeNo);
                                        SMSGonderData.append("PersonelId", PersonelId);
                                        SMSGonderData.append("RandevuId", id);
                                        $.ajax({
                                            type: "POST",
                                            datatype: 'json',
                                            data: SMSGonderData,
                                            contentType: false,
                                            processData: false,
                                            beforeSend: function () {
                                                Swal.fire(
                                                    {
                                                        title: "Müşteriye Bilgi SMS'i Gönderiliyor!",
                                                        html: "<strong>Lütfen Bekleyin.</strong>",
                                                        onBeforeOpen: function onBeforeOpen() {
                                                            Swal.showLoading();
                                                        }
                                                    });
                                            },
                                            url: "/Otomasyon/RezervasyonIslemleri/CekimRandevuSMSGonder/",
                                            success: function (data) {
                                                if (data.Sonuc == false) {
                                                    alertify.set('notifier', 'delay', 5);
                                                    alertify.set('notifier', 'position', 'top-center');
                                                    alertify.error(data.Mesaj);
                                                    swal.close();
                                                }
                                                else if (data.Sonuc == true) {
                                                    alertify.set('notifier', 'delay', 3);
                                                    alertify.set('notifier', 'position', 'top-center');
                                                    alertify.success(data.Mesaj);
                                                    swal.close();
                                                }
                                            },
                                            error: function (err) {
                                                alert("HATA");
                                            }
                                        });
                                    }
                                });

                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });


            }); // Çekim Randevusu Bilgi SMSi gönder
            // ------ Çekim Randevusu Ekleme/Silme İşlemleri
            $('input').on('focusout', function (e) {
                if ($(this).val != "") {
                    $(this).next("div.hata").remove();
                }
            }); // Validation hata kaldırma

            // Randevu ekleme sekmesindeki personel seçim işlemi
            var RandevuPersonelListesi = $("#PersonelListesi :checkbox");
            RandevuPersonelListesi.on("change", function () {
                SecilenRandevuPersonel();
            });
            function SecilenRandevuPersonel() {
                while (RandevuPersonelIdArray.length > 0) {
                    RandevuPersonelIdArray.pop();
                }
                RandevuPersonelListesi.filter(":checked").each(function () {
                    var persid = $(this).data("spersid").replace("cekim-", "");
                    RandevuPersonelIdArray.push($(this).data("spersid").replace("cekim-", ""));
                });
            }

            // Sozlesme sekmesindeki personel seçim işlemi
            var SozlesmePersonelListesi = $("#SozlesmePersonelListesi :checkbox");
            SozlesmePersonelListesi.on("change", function () {
                SecilenSozlesmePersonel();
            });
            function SecilenSozlesmePersonel() {
                while (SozlesmePersonelIdArray.length > 0) {
                    SozlesmePersonelIdArray.pop();
                }
                SozlesmePersonelListesi.filter(":checked").each(function () {
                    SozlesmePersonelIdArray.push($(this).data("persid"));
                });
            }

            $('#RezervasyonTurId').on('focusout', function (e) {
                if ($(this).val != "0") {
                    $("#RezervasyonTurHata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#RezervasyonTurId').on('change', function (e) {
                if ($(this).val != "0") {
                    $("#RezervasyonTurHata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#OpsiyonTarihi').on('focusout', function (e) {
                if ($(this).val != "0") {
                    $("#opsiyonhata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#ZamanDilimiId').on('focusout', function (e) {
                if ($(this).val != "0") {
                    $("#zamandilimihata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#ZamanDilimiId').on('change', function (e) {
                if ($(this).val != "0") {
                    $("#zamandilimihata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#CekimPersonelId').on('focusout', function (e) {
                if ($(this).val != "0") {
                    $("#cekimpersonelihata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#CekimPersonelId').on('change', function (e) {
                if ($(this).val != "0") {
                    $("#cekimpersonelihata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#OdemeTutar').on('focusout', function (e) {
                if ($(this).val != "0") {
                    $("#odemetutarhata").remove();
                }
            }); // zorunlu alan kontrolü
            $('#KalanOdemeTutar').on('focusout', function (e) {
                if ($(this).val != "0") {
                    $("#kalanodemetutarhata").remove();
                }
            }); // zorunlu alan kontrolü

            $("#RezervasyonBilgileriDevam").click(function () {
                // Zorunlu alanların kontrolü yapılıyor.
                SecilenSozlesmePersonel();
                var opsiyontarih = $("#OpsiyonTarihi").val().split('.');
                var rezervasyontarih = $("#RezervasyonTarihi").val().split('.');
                opsiyontarih = opsiyontarih[2] + opsiyontarih[1] + opsiyontarih[0];
                rezervasyontarih = rezervasyontarih[2] + rezervasyontarih[1] + rezervasyontarih[0];

                if ($("#RezervasyonTurId").val() == "0") {
                    $("#RezervasyonTurId").focus();
                    $("#RezervasyonTurIdHata").append("<div id='RezervasyonTurHata' style='color:red'>Rezervasyon Türünü Seçiniz.</div>");
                }
                else if (($("#RezervasyonSekliId").val() != "1") && (parseInt(opsiyontarih) >= parseInt(rezervasyontarih))) {
                    $("#OpsiyonTarihiHata").append("<div id='opsiyonhata' style='color:red'>Opsiyon Tarihi Rezervasyon Tarihinden geri bir tarih olmalıdır.</div>");
                }
                else if (($("#ZamanDilimiId").val() == "0") && ($("#BaslangicZaman").val() == $("#BitisZaman").val())) {
                    $("#BaslangicZaman").focus();
                    $("#ZamanHata").append("<div id='zamandilimihata' style='color:red'>Başlangıç ve Bitiş zamanları aynı olamaz.</div>");
                }
                else if (SozlesmePersonelIdArray.length == 0) {
                    $("#sozlesmepersonellisthata").append("<div id='SozlesmePersonelHata' style='color:red'>Lütfen görevli Personel(ler)i seçiniz.</div>");
                }
                else {
                    //  Tatil Kontrol
                    var rezervasyontarih = $("#RezervasyonTarihi").val();
                    var TatilKontrolData = new FormData();
                    TatilKontrolData.append("RezervasyonTarihi", $("#RezervasyonTarihi").val());
                    $.ajax({
                        type: "POST",
                        datatype: 'json',
                        data: TatilKontrolData,
                        contentType: false,
                        processData: false,
                        url: "/Otomasyon/RezervasyonIslemleri/TatilKotrol/",
                        success: function (data) {
                            if (data.Sonuc == false) {
                                Swal.fire(
                                    {
                                        title: "Dikkat",
                                        html: "<p><h2 style='font-size:16px; color:red'><strong>Rezervasyon Terihi : </strong>" + rezervasyontarih + "</h2></p><h4> " + data.Mesaj + "</h4>",
                                        type: "warning",
                                        confirmButtonText: "Tamam"
                                    });
                                return false;
                            }
                            else if (data.Sonuc == true) {
                                // Personel İzin Kontrol
                                var PersonelData = new FormData();
                                PersonelData.append("RezervasyonTarihi", $("#RezervasyonTarihi").val());
                                PersonelData.append("PersonelIdArray", SozlesmePersonelIdArray);
                                $.ajax({
                                    type: "POST",
                                    datatype: 'json',
                                    data: PersonelData,
                                    contentType: false,
                                    processData: false,
                                    url: "/Otomasyon/RezervasyonIslemleri/PersonelIzinKontrol/",
                                    success: function (data) {
                                        if (data.Sonuc == false) {
                                            var personelAdi = "";
                                            $.each(data.CalisamazPersonel, function (index, pers) {
                                                personelAdi = personelAdi + pers.AdiSoyadi + "<br/>";
                                            });
                                            Swal.fire(
                                                {
                                                    title: "Dikkat",
                                                    html: "<p><h4 style='font-size:16px; color:red'> Aşağıdaki Personel(ler) rezervasyon tarihinde izinliler</h4></p> <p><h2> <strong> " + personelAdi + " </strong><h2> </p>",
                                                    type: "warning",
                                                    confirmButtonText: "Tamam"
                                                });
                                            return false;
                                        }
                                        else if (data.Sonuc == true) {
                                            // Görevlendirme Kontrol
                                            var ZamanDilimiId = $("#ZamanDilimiId").find("option:selected").val();
                                            var BaslangicSaati = $("#BaslangicZaman").val();
                                            var BitisSaati = $("#BitisZaman").val();
                                            var Tarih = $("#RezervasyonTarihi").val();
                                            var SozlesmeId = $("#SozlesmeId").val();
                                            var GorevlendirmeKontrolData = new FormData();
                                            GorevlendirmeKontrolData.append("RezervasyonTarihi", Tarih);
                                            GorevlendirmeKontrolData.append("PersonelIdArray", SozlesmePersonelIdArray);
                                            GorevlendirmeKontrolData.append("ZamanDilimiId", ZamanDilimiId);
                                            GorevlendirmeKontrolData.append("BaslangicSaati", BaslangicSaati);
                                            GorevlendirmeKontrolData.append("BitisSaati", BitisSaati);
                                            GorevlendirmeKontrolData.append("SozlesmeId", SozlesmeId);
                                            $.ajax({
                                                type: "POST",
                                                datatype: 'json',
                                                data: GorevlendirmeKontrolData,
                                                contentType: false,
                                                processData: false,
                                                url: "/Otomasyon/RezervasyonIslemleri/GorevlendirmeKontrol/",
                                                success: function (data) {
                                                    if (data.Sonuc == false) {
                                                        console.log("Çalışamazzz.");
                                                        var personelAdi = "";
                                                        $.each(data.CalisamazPersonel, function (index, pers) {
                                                            personelAdi = personelAdi + pers.AdiSoyadi + "<br/>";
                                                        });
                                                        Swal.fire(
                                                            {
                                                                title: "Dikkat",
                                                                html: "<p><h4 style='font-size:16px; color:red'> Aşağıdaki Personel(ler) rezervasyon tarihinde başka bir randevu için görevlendirilmiş.</h4></p> <p><h2> <strong> " + personelAdi + " </strong><h2> </p>",
                                                                type: "warning",
                                                                confirmButtonText: "Tamam"
                                                            });
                                                        return false;
                                                    }
                                                    else if (data.Sonuc == true) {
                                                        console.log("Çalışabilir.");
                                                        var SozlesmeData = new FormData();
                                                        SozlesmeData.append("SozlesmeTarihi", $("#SozlesmeTarihi").val());
                                                        SozlesmeData.append("SozlesmeNo", $("#SozlesmeNo").val());
                                                        //SozlesmeData.append("Yetkili", $("#Yetkili").val());
                                                        //SozlesmeData.append("PersonelId", $("#PersonelId").val());
                                                        SozlesmeData.append("PersonelIdArray", SozlesmePersonelIdArray);
                                                        SozlesmeData.append("RezervasyonTurId", $("#RezervasyonTurId").val());
                                                        SozlesmeData.append("OrganizasyonYeri", $("#OrganizasyonYeri").val());
                                                        SozlesmeData.append("RezervasyonSekliId", $("#RezervasyonSekliId").val());
                                                        SozlesmeData.append("OpsiyonTarihi", $("#OpsiyonTarihi").val());
                                                        SozlesmeData.append("RezervasyonTarihi", $("#RezervasyonTarihi").val());
                                                        SozlesmeData.append("ZamanDilimiId", $("#ZamanDilimiId").val());
                                                        SozlesmeData.append("BaslangicZaman", $("#BaslangicZaman").val());
                                                        SozlesmeData.append("BitisZaman", $("#BitisZaman").val());
                                                        $.ajax({
                                                            type: "POST",
                                                            datatype: 'json',
                                                            data: SozlesmeData,
                                                            contentType: false,
                                                            processData: false,
                                                            url: "/Otomasyon/RezervasyonIslemleri/SozlesmeGuncelle/" + sozlesmeId,
                                                            success: function (data) {
                                                                if (data.Sonuc == false) {
                                                                    alertify.set('notifier', 'delay', 5);
                                                                    alertify.set('notifier', 'position', 'top-center');
                                                                    alertify.error(data.Mesaj);
                                                                }
                                                                else if (data.Sonuc == true) {
                                                                    alertify.set('notifier', 'delay', 3);
                                                                    alertify.set('notifier', 'position', 'top-center');
                                                                    alertify.success(data.Mesaj);
                                                                }
                                                            },
                                                            error: function (err) {
                                                                alert("HATA");
                                                            }
                                                        });
                                                    }
                                                },
                                                error: function (err) {
                                                    alert("HATA");
                                                }
                                            });
                                        }
                                    },
                                    error: function (err) {
                                        alert("HATA");
                                    }
                                });
                            }
                        },
                        error: function (err) {
                            alert("HATA");
                        }
                    });
                }
            });
            $("#MusteriBilgileriDevam").click(function () {
                if (musteriid == 0) { // Müşteri seçilmemiş ise zorunlu alanlar kontrol edilecek sonra müşteri kaydı yapılacak.
                    if ($("#AdSoyad").val() == "") // Kişi seçilmişse zorunlu alan kontrolü
                    {
                        $("#AdSoyad").focus();
                        $("#AdSoyadHata").append("<div class='hata' style='color:red'>Müşteri Adını Soyadını Giriniz.</div>");
                    }
                    else if ($("#CepTel").val() == "") // Kişi seçilmişse zorunlu alan kontrolü
                    {
                        $("#CepTel").focus();
                        $("#CepTelHata").append("<div class='hata' style='color:red'>Müşterinin Cep Telefonu Numarasını Giriniz.</div>");
                    }
                    else {
                        var Musteri = new FormData();
                        Musteri.append("MusteriKodu", $("#MusteriKodu").val());
                        Musteri.append("TCKimlikNo", $("#TCKimlikNo").val());
                        Musteri.append("AdSoyad", $("#AdSoyad").val());
                        Musteri.append("CepTel", $("#CepTel").val());
                        Musteri.append("SabitTel", $("#SabitTel").val());
                        Musteri.append("Email", $("#Email").val());
                        Musteri.append("Adres", $("#Adres").val());
                        Musteri.append("Notlar", $("#Notlar").val());
                        $.ajax({
                            type: "POST",
                            datatype: 'json',
                            data: Musteri,
                            contentType: false,
                            processData: false,
                            url: "/Otomasyon/Musteriler/MusteriEkle/",
                            success: function (data) {
                                musteriid = data.MusteriId;
                                var Sozlesme = new FormData();
                                Sozlesme.append("SozlesmeId", sozlesmeId);
                                Sozlesme.append("SozlesmeNo", sozlesmeNo);
                                Sozlesme.append("MusteriId", musteriid);
                                $.ajax({
                                    type: "POST",
                                    datatype: 'json',
                                    data: Sozlesme,
                                    contentType: false,
                                    processData: false,
                                    url: "/Otomasyon/RezervasyonIslemleri/SozlesmeMusteriGuncelle/",
                                    success: function (data) {
                                        if (data.Sonuc == false) {
                                            alertify.set('notifier', 'delay', 5);
                                            alertify.set('notifier', 'position', 'top-center');
                                            alertify.error(data.Mesaj);
                                        }
                                        else if (data.Sonuc == true) {
                                            alertify.set('notifier', 'delay', 3);
                                            alertify.set('notifier', 'position', 'top-center');
                                            alertify.success(data.Mesaj);
                                            dt.api().ajax.reload();
                                        }
                                    },
                                    error: function (err) {
                                        alert("HATA");
                                    }
                                });
                            },
                            error: function (err) {
                                alert("HATA");
                            }
                        });
                    }
                }
                else {
                    // varolan müşteriler içinden seçilen müşteri bilgilerinde değişiklik varsa müşteri tablosunda güncellenmeli
                    var Musteri = new FormData();
                    Musteri.append("MusteriKodu", $("#MusteriKodu").val());
                    Musteri.append("TCKimlikNo", $("#TCKimlikNo").val());
                    Musteri.append("AdSoyad", $("#AdSoyad").val());
                    Musteri.append("CepTel", $("#CepTel").val());
                    Musteri.append("SabitTel", $("#SabitTel").val());
                    Musteri.append("Email", $("#Email").val());
                    Musteri.append("Adres", $("#Adres").val());
                    Musteri.append("Notlar", $("#Notlar").val());
                    $.ajax({
                        type: "POST",
                        datatype: 'json',
                        data: Musteri,
                        contentType: false,
                        processData: false,
                        url: "/Otomasyon/Musteriler/MusteriGuncelle/" + musteriid,
                        success: function (data) {
                        },
                        error: function (err) {
                            alert("HATA");
                        }
                    });

                    var Sozlesme = new FormData();
                    Sozlesme.append("SozlesmeId", sozlesmeId);
                    Sozlesme.append("SozlesmeNo", sozlesmeNo);
                    Sozlesme.append("MusteriId", musteriid);
                    $.ajax({
                        type: "POST",
                        datatype: 'json',
                        data: Sozlesme,
                        contentType: false,
                        processData: false,
                        url: "/Otomasyon/RezervasyonIslemleri/SozlesmeMusteriGuncelle/",
                        success: function (data) {
                            //DigerBilgilerAktif();
                            if (data.Sonuc == false) {
                                alertify.set('notifier', 'delay', 5);
                                alertify.set('notifier', 'position', 'top-center');
                                alertify.error(data.Mesaj);
                            }
                            else if (data.Sonuc == true) {
                                alertify.set('notifier', 'delay', 3);
                                alertify.set('notifier', 'position', 'top-center');
                                alertify.success(data.Mesaj);
                                dt.api().ajax.reload();
                            }
                        },
                        error: function (err) {
                            alert("HATA");
                        }
                    });
                }
            });
            $("#DigerBilgilerDevam").click(function () {
                var DegerBilgiler = new FormData();
                DegerBilgiler.append("SozlesmeId", sozlesmeId);
                DegerBilgiler.append("RandevuId", randevuId);
                DegerBilgiler.append("SozlesmeNo", sozlesmeNo);
                DegerBilgiler.append("GelinAdSoyad", $("#GelinAdSoyad").val());
                DegerBilgiler.append("GelinCep", $("#GelinCep").val());
                DegerBilgiler.append("GelinEmail", $("#GelinEmail").val());
                DegerBilgiler.append("DamatAdSoyad", $("#DamatAdSoyad").val());
                DegerBilgiler.append("DamatCep", $("#DamatCep").val());
                DegerBilgiler.append("DamatEmail", $("#DamatEmail").val());
                DegerBilgiler.append("BebekAdSoyad", $("#BebekAdSoyad").val());
                DegerBilgiler.append("BabaAdSoyad", $("#BabaAdSoyad").val());
                DegerBilgiler.append("AnneAdSoyad", $("#AnneAdSoyad").val());
                DegerBilgiler.append("BabaCep", $("#BabaCep").val());
                DegerBilgiler.append("AnneCep", $("#AnneCep").val());
                DegerBilgiler.append("BabaEmail", $("#BabaEmail").val());
                DegerBilgiler.append("Urunler", $("#Urunler").val());
                DegerBilgiler.append("UrunYetkiliAdSoyad", $("#UrunYetkiliAdSoyad").val());
                DegerBilgiler.append("UrunYetkiliCep", $("#UrunYetkiliCep").val());
                DegerBilgiler.append("UrunYetkiliEmail", $("#UrunYetkiliEmail").val());
                DegerBilgiler.append("Modeller", $("#Modeller").val());
                DegerBilgiler.append("ModelYetkiliAdSoyad", $("#ModelYetkiliAdSoyad").val());
                DegerBilgiler.append("ModelYetkiliCep", $("#ModelYetkiliCep").val());
                DegerBilgiler.append("ModelYetkiliEmail", $("#ModelYetkiliEmail").val());
                DegerBilgiler.append("YetkiliAdSoyad", $("#YetkiliAdSoyad").val());
                DegerBilgiler.append("YetkiliCep", $("#YetkiliCep").val());
                DegerBilgiler.append("YetkiliEmail", $("#YetkiliEmail").val());
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    data: DegerBilgiler,
                    contentType: false,
                    processData: false,
                    url: "/Otomasyon/RezervasyonIslemleri/SozlesmeDigerBilgilerGuncelle/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            alertify.set('notifier', 'delay', 5);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.error(data.Mesaj);
                        }
                        else if (data.Sonuc == true) {
                            alertify.set('notifier', 'delay', 3);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.success(data.Mesaj);
                            dt.api().ajax.reload();
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            });
            $("#PaketlerDevam").click(function () {
                var PaketlerFiyat = $("#PaketTutar").val().replace(" TL", "");
                var EkHizmetlerFiyat = $("#EkHizmetTutar").val().replace(" TL", "");
                var Iskonto = $("#Iskonto").val().replace(" TL", "");
                var ToplamTutar = $("#ToplamTutar").val().replace(" TL", "");
                if (PaketlerFiyat == "") {
                    PaketlerFiyat = 0;
                }
                if (EkHizmetlerFiyat == "") {
                    EkHizmetlerFiyat = 0;
                }
                if (Iskonto == "") {
                    Iskonto = 0;
                }
                if (ToplamTutar == "") {
                    ToplamTutar = 0;
                }
                var PaketEkHizmetData = new FormData();
                PaketEkHizmetData.append("SozlesmeId", sozlesmeId);
                PaketEkHizmetData.append("SozlesmeNo", sozlesmeNo);
                PaketEkHizmetData.append("secilenpaketID", secilenpaketID);
                PaketEkHizmetData.append("secilenekhizmetID", secilenekhizmetID);
                PaketEkHizmetData.append("PaketlerFiyat", PaketlerFiyat);
                PaketEkHizmetData.append("EkHizmetlerFiyat", EkHizmetlerFiyat);
                PaketEkHizmetData.append("Iskonto", Iskonto);
                PaketEkHizmetData.append("ToplamTutar", ToplamTutar);
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    data: PaketEkHizmetData,
                    contentType: false,
                    processData: false,
                    url: "/Otomasyon/RezervasyonIslemleri/SozlesmePaketlerEkhizmetlerGuncelle/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            alertify.set('notifier', 'delay', 5);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.error(data.Mesaj);
                        }
                        else if (data.Sonuc == true) {
                            alertify.set('notifier', 'delay', 3);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.success(data.Mesaj);
                            dt.api().ajax.reload();
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            });
            $("#SureclerDevam").click(function () {
                var SureclerData = new FormData();
                SureclerData.append("SozlesmeId", sozlesmeId);
                SureclerData.append("SozlesmeNo", sozlesmeNo);
                SureclerData.append("secilensurecID", secilensurecID);
                $.ajax({
                    type: "POST",
                    datatype: 'json',
                    data: SureclerData,
                    contentType: false,
                    processData: false,
                    url: "/Otomasyon/RezervasyonIslemleri/SureclerGuncelle/",
                    success: function (data) {
                        if (data.Sonuc == false) {
                            alertify.set('notifier', 'delay', 5);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.error(data.Mesaj);
                        }
                        else if (data.Sonuc == true) {
                            alertify.set('notifier', 'delay', 3);
                            alertify.set('notifier', 'position', 'top-center');
                            alertify.success(data.Mesaj);
                            dt.api().ajax.reload();
                        }
                    },
                    error: function (err) {
                        alert("HATA");
                    }
                });
            });
            $("#CekimRandevuDevam").click(function () {
                alertify.set('notifier', 'delay', 3);
                alertify.set('notifier', 'position', 'top-center');
                alertify.success("Tüm Bilgiler Kaydedildi");
            });
            $("#OdemelerSozlesmeGoruntule").click(function () {
                $('#KalanOdemeTarihi').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                        autoclose: true
                    }).datepicker("setDate", new Date(new Date().setMonth(new Date().getMonth() + 1)));
                var SozlesmeKalan = $("#sozlesmekalan").html();
                SozlesmeKalan = SozlesmeKalan.replace(" TL", "");
                SozlesmeKalan = SozlesmeKalan.replace(".", "");
                SozlesmeKalan = SozlesmeKalan.replace(",", ".");

                var Tutar = accounting.formatMoney(SozlesmeKalan, "TL", 2, ".", ",", "%v %s");
                var Tarih = new Date();
                var gun = Tarih.getDate();
                if (gun < 10) {
                    gun = "0" + gun;
                }
                var ay = Tarih.getMonth() + 2;
                var yil = Tarih.getFullYear();

                if (parseFloat(SozlesmeKalan) > 0) {
                    Swal.fire(
                        {
                            title: "Kalan Ödeme",
                            html: "<p style='color:red;font-weight:bold;font-size:12pt;'> Sözleşme tutarının " + Tutar + " 'si kaldı.</p> <p style='color:red;font-size:12pt;'><h3>Bu tutarı bir ay sonrasına (" + gun + "." + ay + "." + yil + ") Gelecek Ödeme olarak eklemek istermisiz?</h3></p> ",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonText: "Evet, Devam et!",
                            cancelButtonText: "İptal"
                        }).then(function (result) {
                            if (result.value) {
                                var kalanodeme = Tutar.replace(" TL", "");
                                var AlacakData = new FormData();
                                AlacakData.append("SozlesmeId", sozlesmeId);
                                AlacakData.append("SozlesmeNo", sozlesmeNo);
                                AlacakData.append("MusteriId", musteriid);
                                AlacakData.append("KalanOdemeTarihi", $('#KalanOdemeTarihi').val());
                                //AlacakData.append("KalanOdemeTutar", $("#KalanOdemeTutar").val());
                                AlacakData.append("KalanOdemeTutar", kalanodeme);
                                AlacakData.append("KalanOdemeAciklama", $("#KalanOdemeAciklama").val());
                                $.ajax({
                                    type: "POST",
                                    datatype: 'json',
                                    data: AlacakData,
                                    contentType: false,
                                    processData: false,
                                    beforeSend: function () {
                                        Swal.fire(
                                            {
                                                title: "Sayfa Yenileniyor.!",
                                                html: "<strong>Lütfen Bekleyin.</strong>",
                                                onBeforeOpen: function onBeforeOpen() {
                                                    Swal.showLoading();
                                                }
                                            });
                                    },
                                    url: "/Otomasyon/RezervasyonIslemleri/AlacakEkle/",
                                    success: function (data) {
                                        if (data.Sonuc == false) {
                                            alertify.set('notifier', 'delay', 5);
                                            alertify.set('notifier', 'position', 'top-center');
                                            alertify.error(data.Mesaj);
                                        }
                                        else if (data.Sonuc == true) {
                                            alertify.set('notifier', 'delay', 3);
                                            alertify.set('notifier', 'position', 'top-center');
                                            alertify.success(data.Mesaj);
                                            alacaktoplam = 0; // global değişken sıfırlanıyor.
                                            var alacaktutar = 0;
                                            //window.location.replace("/Otomasyon/Dashboard/Index");
                                            //window.location.replace("/Otomasyon/RezervasyonIslemleri/RezervasyonListesi");
                                            //window.open("/Otomasyon/RezervasyonIslemleri/SozlesmeYazdir/" + sozlesmeNo, '_blank');
                                            $.ajax({
                                                type: "POST",
                                                datatype: 'json',
                                                contentType: false,
                                                processData: false,
                                                url: "/Otomasyon/RezervasyonIslemleri/BilgiSmsMailGonder/" + sozlesmeId,
                                                success: function (data) {
                                                    if (data.Sonuc == true) {
                                                        //window.location.replace("/Otomasyon/Dashboard/Index");
                                                        window.location.replace("/Otomasyon/RezervasyonIslemleri/RezervasyonListesi");
                                                        window.open("/Otomasyon/RezervasyonIslemleri/SozlesmeYazdir/" + sozlesmeNo, '_blank');
                                                    }
                                                },
                                                error: function (err) {
                                                    $("#YeniRezervasyonEkleModal").modal("hide");
                                                    alert("HATA");
                                                }
                                            });
                                        }

                                    },
                                    error: function (err) {
                                        alert("HATA");
                                    }
                                });
                            }
                        });
                }
                else {
                    $.ajax({
                        type: "POST",
                        datatype: 'json',
                        contentType: false,
                        processData: false,
                        url: "/Otomasyon/RezervasyonIslemleri/BilgiSmsMailGonder/" + sozlesmeId,
                        success: function (data) {
                            if (data.Sonuc == true) {
                                //window.location.replace("/Otomasyon/Dashboard/Index");
                                window.location.replace("/Otomasyon/RezervasyonIslemleri/RezervasyonListesi");
                                window.open("/Otomasyon/RezervasyonIslemleri/SozlesmeYazdir/" + sozlesmeNo, '_blank');
                            }
                        },
                        error: function (err) {
                            $("#YeniRezervasyonEkleModal").modal("hide");
                            alert("HATA");
                        }
                    });
                }
            });
        });
    </script>
}

