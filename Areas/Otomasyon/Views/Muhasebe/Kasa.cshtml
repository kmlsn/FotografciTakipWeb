
@{
    ViewBag.Title = "Kasa";
    Layout = "~/Areas/Otomasyon/Views/Shared/_Layout.cshtml";
}
@using FotografciTakipWeb.Models
@model List<GelirGider>
@{
    KullaniciYetki yetki = ViewBag.Yetki;
    KullaniciYetki yetkilendir = ViewBag.Yetkilendir;
    List<Firma> FirmaListesi = ViewBag.FirmaListesi;
    List<Sube> SubeListesi = ViewBag.SubeListesi;
    List<SubeToKullanici> SubeKullanici = ViewBag.SubeKullanici;
}
<div class="alert alert-primary">
    <div class="d-flex flex-start w-100">
        @*<div class="mr-2 hidden-md-down">
            <span class="icon-stack icon-stack-lg">
                <i class="base base-6 icon-stack-3x opacity-100 color-primary-500"></i>
                @*<i class="base base-10 icon-stack-2x opacity-100 color-primary-300 fa-flip-vertical"></i>
                <i class="fal fa-info icon-stack-1x opacity-100 color-white pb-1"></i>
            </span>
        </div>*@
        <div class="alert-icon">
            <i class="fal fa-info-circle"></i>
        </div>
        <div class="d-flex flex-fill">
            <div class="flex-fill">
                <span class="h5">Bilgi</span>
                <p>Kasa detaylarını <a href="~/Otomasyon/Muhasebe/GelirlerGiderler"><strong>GELİRLER-GİDERLER</strong></a> menüsünden görebilirsiniz. Kasa işlemlerin toplamını görebileceğiniz bölümdür.</p>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xl-12">
        <div id="panel-1" class="panel shadow-5">
            <div class="row col col-12 mt-3" id="date_filter">
                <div class="form-group col-sm-2">
                    <div class="input-group">
                        <input type="text" class="form-control form-control-sm" value="07/17/2020" id="IlkTarih">
                        <div class="input-group-append">
                            <span class="input-group-text fs-sm">
                                <i class="fal fa-calendar-alt"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-2">
                    <div class="input-group">
                        <input type="text" class="form-control form-control-sm" value="07/17/2020" id="SonTarih">
                        <div class="input-group-append">
                            <span class="input-group-text fs-sm">
                                <i class="fal fa-calendar-alt"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-3">
                    <select class="custom-select form-control custom-select-sm" id="Sube" name="Sube" title="Görüntülenecek Şube">
                        <option value="0">Tüm Şubeler</option>
                        @foreach (var sube in SubeKullanici)
                        {
                            if (Convert.ToInt64(Session["AktifSubeId"]) == sube.SubeId && sube.Sube.Aktif == true)
                            {
                                <option selected="" value="@sube.Sube.Id">@sube.Sube.SubeAdi</option>
                            }
                            else if (sube.Sube.Aktif == true)
                            {
                                <option value="@sube.Sube.Id">@sube.Sube.SubeAdi</option>
                            }
                        }
                    </select>
                </div>

                <div class="form-group col-sm-3">
                    <select class="custom-select form-control custom-select-sm" id="OdemeSekli" name="OdemeSekli" title="Görüntülenecek Ödeme Şekli">
                        <option selected="" value="Tümü">Ödeme Şekli - Tümü</option>
                        <option value="Nakit">Nakit</option>
                        <option value="Kredi Kartı">Kredi Kartı</option>
                        <option value="Banka Havalesi">Banka Havalesi</option>
                    </select>
                </div>
                <div class="form-group col-sm-1">
                    <button type="button" class="btn btn-sm btn-primary" id="Goster"> Göster </button>
                </div>
            </div>
            <div class="border-bottom mt-3"></div>
            <div class="panel-container show">
                <div class="panel-content">
                    <div class="row">
                        <div class="col-sm-4 col-xl-3">
                            <div class="p-3 bg-primary-500 rounded overflow-hidden position-relative text-white mb-g">
                                <div class="">
                                    @if (ViewBag.ToplamGelir == 0)
                                    {
                                        <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGelir">
                                            0,00 TL
                                            <small class="m-0 l-h-n">Toplam Gelir</small>
                                        </h3>
                                    }
                                    else
                                    {
                                        <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGelir">
                                            @ViewBag.ToplamGelir.ToString("C").Replace("₺", "") TL
                                            <small class="m-0 l-h-n">Toplam Gelir</small>
                                        </h3>
                                    }
                                </div>
                                <i class="fal fa-plus-circle position-absolute pos-right pos-bottom opacity-15 mb-n0 mr-n0" style="font-size:6rem"></i>
                            </div>
                        </div>
                        <div class="col-sm-4 col-xl-3">
                            <div class="p-3 bg-warning-500 rounded overflow-hidden position-relative text-white mb-g">
                                <div class="">
                                    @if (ViewBag.ToplamGider == 0)
                                    {
                                        <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGider">
                                            0.00 TL
                                            <small class="m-0 l-h-n">Toplam Gider</small>
                                        </h3>
                                    }
                                    else
                                    {
                                        <h3 class="display-4 d-block l-h-n m-0 fw-500" id="ToplamGider">
                                            @ViewBag.ToplamGider.ToString("C").Replace("₺", "") TL
                                            <small class="m-0 l-h-n">Toplam Gider</small>
                                        </h3>
                                    }
                                </div>
                                <i class="fal fa-minus-circle position-absolute pos-right pos-bottom opacity-15  mb-n0 mr-n0" style="font-size: 6rem;"></i>
                            </div>
                        </div>
                        <div class="col-sm-4 col-xl-3">
                            <!-- alacak - borç  = sonuç (-) ise Kırmızı (bg-danger-200) olacak , (+) ise yeşil (bg-success-200) olacak, (0) ise gri (bg-fusion-50) olacak-->
                            <div class="p-3 bg-success-800 rounded overflow-hidden position-relative text-white mb-g" id="BakiyeRenk">
                                <div class="">
                                    @if (ViewBag.Kasa == 0)
                                    {
                                        <h3 class="display-4 d-block l-h-n m-0 fw-500" id="Kasa">
                                            0,00 TL
                                            <small class="m-0 l-h-n"><strong>KASA</strong></small>
                                        </h3>
                                    }
                                    else
                                    {
                                        <h3 class="display-4 d-block l-h-n m-0 fw-500" id="Kasa">
                                            @ViewBag.Kasa.ToString("C").Replace("₺", "") TL
                                            <small class="m-0 l-h-n"><strong>KASA</strong></small>
                                        </h3>
                                    }
                                </div>
                                <!-- alacak - borç  = sonuç (-) ise Simge sağa (<i class="fal fa-balance-scale-right"></i>) olacak , (+) ise simge sola(<i class="fal fa-balance-scale-left"></i>) olacak, (0) ise simge ortada (fal fa-balance-scale) olacak-->
                                <i class="fal fa-balance-scale position-absolute pos-right pos-bottom opacity-15 mb-n0 mr-n0" id="BakiyeIkon" style="font-size: 6rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <input type="text" id="FiltreAyar" style="display:none" data-filtreayar="@ViewBag.FiltreAyar">
        </div>
    </div>
</div>
@section Script
{
    <script>
            var dt;
            var filtreayar = $('#FiltreAyar').data("filtreayar");
            var controls = {
                leftArrow: '<i class="fal fa-angle-left" style="font-size: 1.25rem"></i>',
                rightArrow: '<i class="fal fa-angle-right" style="font-size: 1.25rem"></i>'
            }
            var runDatePicker = function () {
                if (filtreayar == "0") {
                    $('#SonTarih').datepicker(
                   {
                       todayBtn: "linked",
                       todayHighlight: true,
                       templates: controls,
                       language: 'tr',
                       autoclose: true
                   }).datepicker("setDate", new Date());
                    $('#IlkTarih').datepicker(
                       {
                           todayBtn: "linked",
                           todayHighlight: true,
                           templates: controls,
                           language: 'tr',
                           autoclose: true
                       }).datepicker("setDate", new Date());
                } // 1 Gün
                else if (filtreayar == "1") {
                    $('#SonTarih').datepicker(
                     {
                         todayBtn: "linked",
                         todayHighlight: true,
                         templates: controls,
                         language: 'tr',
                     }).datepicker("setDate", new Date(new Date().setDate(new Date().getDate() + 7)));
                    $('#IlkTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr'
                    }).datepicker("setDate", new Date(new Date().setDate(new Date().getDate() - 7)));
                } // 1 Hafta Öncesi - 1 Hafta Sonrası
                else if (filtreayar == "2") {
                    $('#SonTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                    }).datepicker("setDate", new Date(new Date().setMonth(new Date().getMonth() + 1)));
                    $('#IlkTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr'
                    }).datepicker("setDate", new Date(new Date().setMonth(new Date().getMonth() - 1)));
                } // 1 Ay Öncesi - 1 Ay Sonrası
                else if (filtreayar == "3") {
                    $('#SonTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                    }).datepicker("setDate", new Date(new Date().setFullYear(new Date().getFullYear() + 1)));
                    $('#IlkTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr'
                    }).datepicker("setDate", new Date(new Date().setFullYear(new Date().getFullYear() - 1)));
                } // 1 Yıl Öncesi - 1 Yıl Sonrası
                else if (filtreayar == "4") {
                    $('#SonTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                        autoclose: true
                    }).datepicker("setDate", new Date());
                    $('#IlkTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                        autoclose: true
                    }).datepicker("setDate", new Date(new Date().getFullYear(), new Date().getMonth(), 1));
                } // Ayın başından bu güne
                else if (filtreayar == "5") {
                    $('#SonTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                        autoclose: true
                    }).datepicker("setDate", new Date());
                    $('#IlkTarih').datepicker(
                    {
                        todayBtn: "linked",
                        todayHighlight: true,
                        templates: controls,
                        language: 'tr',
                        autoclose: true
                    }).datepicker("setDate", new Date(new Date().getFullYear(), 0, 1));
                } // Yılın başından bu güne
            }
            function ParaFormat(fiyat) {
                var para_sembol = "TL"
                var format = new Intl.NumberFormat('de-DE', {
                    style: 'currency',
                    currency: 'TRY',
                    minumumFractionDigits: 2
                })
                //return format.format(fiyat)
                return format.format(fiyat).replace('TRY', para_sembol)
            }
            $(document).ready(function () {
                runDatePicker();
                $("#Goster").click(function () {
                    var GosterData = new FormData();
                    GosterData.append("IlkTarih", $("#IlkTarih").val());
                    GosterData.append("SonTarih", $("#SonTarih").val());
                    GosterData.append("SubeId", $("#Sube").val());
                    GosterData.append("OdemeSekli", $("#OdemeSekli").val());
                    $.ajax({
                        type: "POST",
                        datatype: 'json',
                        data: GosterData,
                        contentType: false,
                        processData: false,
                        url: "/Otomasyon/Muhasebe/KasaFiltrele/",
                        success: function (data) {
                            if (data.Sonuc==true) {
                                $("#ToplamGelir").html(accounting.formatMoney(data.ToplamGelir, "TL", 2, ".", ",", "%v %s") + "<small class='m-0 l-h-n'>Toplam Gelir</small>");
                                $("#ToplamGider").html(accounting.formatMoney(data.ToplamGider, "TL", 2, ".", ",", "%v %s") + "<small class='m-0 l-h-n'>Toplam Gider</small>");
                                $("#Kasa").html(accounting.formatMoney(data.Kasa, "TL", 2, ".", ",", "%v %s") + "<small class='m-0 l-h-n'>KASA</small>");
                            }
                        },
                        error: function (err) {
                            alert("HATA");
                        }
                    });
                });
            });
    </script>
}

